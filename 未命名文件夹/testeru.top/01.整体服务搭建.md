## 搭建系统架构
![](https://gitee.com/javaTesteru/picgo/raw/master/images/testeru/testeru-top-module/202202181746985.png)

通过网关服务「testeru-gateway」{路由}--> 访问前台请求「testeru-front」-->再访问后端请求的统一入口「testeru-boss」 -->然后再到具体的服务
### gateway
网关服务

### front
访问前台请求
### boss
后端请求统一入口
### ad
广告服务
### eureka
注册中心
### config
配置中心
### common
统一工具类
### bom
打包方式改为`pom`



>首先是广告服务「testeru-ad」
>
>这个时候对应的服务还需要注册中心「testeru-eureka」和配置中心「testeru-config」，还需要有testeru-bom、 testeru-common{存放统一的工具类项目}

![](https://gitee.com/javaTesteru/picgo/raw/master/images/testeru/testeru-top-module/202202251732972.png)



## common
>先去完成`tester-common`服务，这个项目存放的是整个大的项目的公用工具类。目前，用到的是2个，后续可以补充。

第一个工具类：属性拷贝工具类「`ConverUtil`」

### 属性拷贝
将数据库表的数据拷贝到一个属性类中
- 添加依赖：
```
<dependency>  
	<groupId>cglib</groupId>  
	<artifactId>cglib</artifactId>  
	<version>3.3.0</version>  
</dependency>
```
- 封装拷贝属性的工具类：`ConvertUtils`

[[BeanCopier]]
```java

```

### 封装响应
- 定义了static修饰的success和ofError方法
	- 成功/失败可以快速返回



## bom
>由于项目需要使用Spring boot和Spring cloud 所以把一些相关的依赖都放在bom服务中

### 添加所有总依赖
#### 依赖统一管理
```
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>io.jsonwebtoken</groupId>
                <artifactId>jjwt</artifactId>
                <version>0.9.1</version>
            </dependency>
            <dependency>
                <groupId>org.springframework.security.oauth</groupId>
                <artifactId>spring-security-oauth2</artifactId>
                <version>2.3.8.RELEASE</version>
            </dependency>
            <!--lombok工具-->
            <dependency>
                <groupId>org.projectlombok</groupId>
                <artifactId>lombok</artifactId>
                <version>1.18.12</version>
                <scope>provided</scope>
            </dependency>

            <!-- hutool -->
            <dependency>
                <groupId>cn.hutool</groupId>
                <artifactId>hutool-all</artifactId>
                <version>5.3.2</version>
            </dependency>

            <!-- https://mvnrepository.com/artifact/org.apache.commons/commons-collections4 -->
            <dependency>
                <groupId>org.apache.commons</groupId>
                <artifactId>commons-collections4</artifactId>
                <version>4.4</version>
            </dependency>

            <!-- mybatis-spring -->
            <dependency>
                <groupId>org.mybatis</groupId>
                <artifactId>mybatis-spring</artifactId>
                <version>2.0.3</version>
            </dependency>

            <!-- mybatis -->
            <dependency>
                <groupId>org.mybatis.spring.boot</groupId>
                <artifactId>mybatis-spring-boot-starter</artifactId>
                <version>2.1.1</version>
            </dependency>

            <!-- fastjson -->
            <dependency>
                <groupId>com.alibaba</groupId>
                <artifactId>fastjson</artifactId>
                <version>1.2.78</version>
            </dependency>

            <!-- druid -->
            <dependency>
                <groupId>com.alibaba</groupId>
                <artifactId>druid</artifactId>
                <version>1.1.21</version>
            </dependency>

            <!-- mysql -->
            <dependency>
                <groupId>mysql</groupId>
                <artifactId>mysql-connector-java</artifactId>
                <version>5.1.47</version>
            </dependency>

            <!-- spring cloud -->
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>Greenwich.RELEASE</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            <!-- spring boot -->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-parent</artifactId>
                <version>2.1.6.RELEASE</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>

```

这是所有业务服务需要的依赖文件

## 注册中心eureka
#### 搭建注册中心
### 编辑pom.xml
- 添加对应父类maven
```
<parent>
	<groupId>top.testeru</groupId>
	<artifactId>testeru-bom</artifactId>
	<version>1.0-SNAPSHOT</version>
</parent>

<dependencies>
	<dependency>
		<groupId>org.springframework.cloud</groupId>
		<artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
	</dependency>
</dependencies>
```

### 添加配置文件
- 添加对应eureka配置

创建`application.yml`

```
#eureka server服务端口
server:
  port: 8761
spring:
  application:
    name: testeru-eureka # 应用名称，应用名称会在Eureka中作为服务名称
eureka:
  instance:
    hostname: localhost
  client:
    service-url: # 配置客户端所交互的Eureka Server的地址
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka
    register-with-eureka: false # 当前服务是否注册给eureka
    fetch-registry: false  # 当前服务是否注册给eureka

```

### 编写启动类
- 编写对应服务启动类Application
```java
package top.testeru;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;


//以springboot方式启动
@SpringBootApplication
//作为注册中心服务端
@EnableEurekaServer
public class TesteruEurekaApplication {
    public static void main(String[] args) {
        SpringApplication.run(TesteruEurekaApplication.class,args);
    }
}

```

[[springboot启动报错]]

- 启动成功后，对应浏览器输入：`http://localhost:8761/`

页面展示如下，对应说明注册中心启动正常

![](https://gitee.com/javaTesteru/picgo/raw/master/images/testeru/testeru-top-module/202202252111015.png)

## repo

#### 搭建配置中心
- 创建`git`仓库`top-testeru-repo`，新建文件`testeru-ad-dev.yml`

![](https://gitee.com/javaTesteru/picgo/raw/master/images/testeru/testeru-top-module/202202252112866.png)

- 编写配置文件

```
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://sh-cdb-4ko89lc6.sql.tencentcdb.com:59676/testeru_ad?characterEncoding=UTF-8&useUnicode=true&useSSL=false&serverTimezone=GMT
    username: root
    password: luoluo606709
```

## 配置中心config
>对应配置中心
### 添加依赖

```xml
    <parent>
        <groupId>top.testeru</groupId>
        <artifactId>testeru-bom</artifactId>
        <version>1.0-SNAPSHOT</version>
    </parent>
    
    <dependencies>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-config-server</artifactId>
        </dependency>

    </dependencies>
```

### 配置文件

>告诉配置中心对应的远程仓库是谁


创建`application.yml`

```
server:
  port: 8090

spring:
  application:
    name: edu-config-boot
  cloud:
    config:
      server:
        git:
          uri: uri
          username: 用户名
          password: 密码
          default-label: 分支
```


### 编写启动类


```java
package top.testeru;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.config.server.EnableConfigServer;


//使用springboot启动
@SpringBootApplication
//当前是配置中心
@EnableConfigServer
public class TesteruConfigApplication {
    public static void main(String[] args) {
        SpringApplication.run(TesteruConfigApplication.class,args);
        
    }
}

```
### 验证
- 访问地址：`http://localhost:8090/testeru-ad-dev.yml`

[testeru-ad-dev.yml](http://localhost:8090/testeru-ad-dev.yml)

![](https://gitee.com/javaTesteru/picgo/raw/master/images/testeru/testeru-top-module/202202252132881.png)

>以上，说明对应服务启动成功

# 广告模块
## 广告需求
- 一个广告位对应多个广告

### 广告位
#### 顶部广告位
#### 侧边栏广告位

>广告位固定，一般好几年都不会进行更换

### 广告列表
#### 添加广告
#### 编辑广告
#### 广告和广告位关联

## 需求设计

#### 广告功能图
![](https://gitee.com/javaTesteru/picgo/raw/master/images/testeru/testeru-top-module/202202252141512.png)


## 1. 创建数据库，新建表

```
create database testeru_ad;
DROP TABLE IF EXISTS `promotion_space`;
CREATE TABLE `promotion_space` (
								`id` int NOT NULL AUTO_INCREMENT COMMENT '主键',
								`name` varchar(255) DEFAULT NULL COMMENT '名称',
								`space_key` varchar(255) DEFAULT NULL COMMENT '广告位key',
								`create_time` datetime DEFAULT NULL COMMENT '创建时间',
								`update_time` datetime DEFAULT NULL COMMENT '更新时间',
								`is_del` int DEFAULT '0' COMMENT '状态:是否删除',
								PRIMARY KEY (`id`) USING BTREE,
								KEY `promotion_space_key_isDel` (`spaceKey`,`isDel`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=184 DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT COMMENT = '广告位关联表';


DROP TABLE IF EXISTS `promotion_ad`;
CREATE TABLE `promotion_ad` (
                                `id` int NOT NULL AUTO_INCREMENT COMMENT '主键',
                                `name` varchar(255) DEFAULT NULL COMMENT '广告名',
                                `space_id` int DEFAULT NULL COMMENT '广告位id',
                                `keyword` varchar(255) DEFAULT NULL COMMENT '精确搜索关键词',
                                `html_content` text COMMENT '静态广告的内容',
                                `text` varchar(255) DEFAULT NULL COMMENT '文字一',
                                `link` varchar(255) DEFAULT NULL COMMENT '链接一',
                                `start_time` datetime DEFAULT NULL COMMENT '开始时间',
                                `end_time` datetime DEFAULT NULL COMMENT '结束时间',
                                `create_time` datetime DEFAULT NULL COMMENT '创建时间',
                                `update_time` datetime DEFAULT NULL COMMENT '更新时间',
                                `status` int NOT NULL DEFAULT '0' COMMENT '状态',
                                `priority` int DEFAULT '0' COMMENT '优先级',
                                `img` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT '图片地址',
                                PRIMARY KEY (`id`) USING BTREE,
                                KEY `promotion_ad_SEG` (`space_id`,`start_time`,`end_time`,`status`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1095 DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT COMMENT = '广告位表';

```


## 2. 创建项目，引入依赖
创建项目edu-ad-boot，添加依赖
```
<parent>
	<groupId>top.testeru</groupId>
	<artifactId>testeru-bom</artifactId>
	<version>1.0-SNAPSHOT</version>
</parent>
<dependencies>
	<dependency>
		<groupId>top.testeru</groupId>
		<artifactId>testeru-common</artifactId>
	</dependency>
</dependencies>

```

以及两个子项目edu-ad-boot-api和edu-ad-boot-impl。

>借鉴dubbo项目的设计风格，经典的设计方式。统一的对外接口放入api的项目内，实现远程调用。实现接口的类放在impl，真正提供服务的一个类，数据的增删改查操作。

- `impl`：连接数据库进行操作。

分别添加依赖


### edu-ad-boot-impl

- 连接数据库，实现对数据的增删改查




[[02.广告服务开发]]