---
tags: note
status: todo
priority: 1
time: 2022-05-29 12:55
things:  "[ğŸ§Š](things:///show?id=JtkDsmtmq6Bd8ZbzKBJTW4)"
---
# äº”ç§é€šçŸ¥
## å‰ç½®é€šçŸ¥-BeforeEach
#### aop:beforeæ ‡ç­¾
- [l] é…ç½®â½…å¼ï¼š`aop:before`æ ‡ç­¾
```xml
<!--
    ä½œâ½¤ï¼š
        â½¤äºé…ç½®å‰ç½®é€šçŸ¥ã€‚
    å‡ºç°ä½ç½®ï¼š
        å®ƒåªèƒ½å‡ºç°åœ¨aop:aspectæ ‡ç­¾å†…éƒ¨
    å±æ€§ï¼š
        methodï¼šâ½¤äºæŒ‡å®šå‰ç½®é€šçŸ¥çš„â½…æ³•åç§°
        pointcutï¼šâ½¤äºæŒ‡å®šåˆ‡â¼Šç‚¹è¡¨è¾¾å¼
        pointcut-refï¼šâ½¤äºæŒ‡å®šåˆ‡â¼Šç‚¹è¡¨è¾¾å¼çš„å¼•â½¤
-->
<aop:before method="getLog" pointcut-ref="pointcut1"></aop:before>
```

- [S] <font color="red">aop:before</font>
    - [I]  é…ç½®å‰ç½®é€šçŸ¥
    - [I]  ä½ç½®ï¼š<mark style="background: #6FE26FA6;">aop:aspectæ ‡ç­¾å†…éƒ¨</mark>
- [S] <font color="purple">method</font>
    - [I]  æŒ‡å®šå‰ç½®é€šçŸ¥çš„â½…æ³•å
- [S] <font color="purple">pointcut</font>
    - [I] æŒ‡å®šåˆ‡â¼Šç‚¹è¡¨è¾¾å¼
- [S] <font color="purple">pointcut-ref</font>
    - [I] åˆ‡â¼Šç‚¹è¡¨è¾¾å¼çš„å¼•â½¤


- [b] æ‰§â¾æ—¶æœº
    - [i] å‰ç½®é€šçŸ¥æ°¸è¿œéƒ½ä¼šåœ¨åˆ‡â¼Šç‚¹â½…æ³•ï¼ˆä¸šåŠ¡æ ¸â¼¼â½…æ³•ï¼‰æ‰§â¾ä¹‹å‰æ‰§â¾ã€‚
- [b] ç»†èŠ‚
    - [i] å‰ç½®é€šçŸ¥å¯ä»¥è·å–åˆ‡â¼Šç‚¹â½…æ³•çš„å‚æ•°ï¼Œå¹¶å¯¹å…¶è¿›â¾å¢å¼ºã€‚
  
  ```java
  //è·å–æ–¹æ³•çš„å‚æ•°å€¼   [é‡Œé¢æ˜¯ä¼ å…¥çš„å‚æ•°å€¼]
  Object[] args = joinPoint.getArgs();
  ```

```java
public class LogUtil {
  public void getLog(JoinPoint joinPoint) throws Throwable {
      //æ‰“å°executionè¡¨è¾¾å¼
      //execution(void top.testeru.service.AccountService.save())
      System.out.println(joinPoint);
      //è·å–æ‹¦æˆªçš„æ–¹æ³• void top.testeru.service.AccountService.save()
      System.out.println(joinPoint.getSignature());
      Object[] args = joinPoint.getArgs();
      System.out.println(Arrays.toString(args));//[é‡Œé¢æ˜¯ä¼ å…¥çš„å‚æ•°å€¼]
      System.out.println("æ‰“å°å½“å‰log");
  }
}
```

## åç½®é€šçŸ¥-tryæ¨¡å—çš„return
#### aop:after-returningæ ‡ç­¾
- [l] é…ç½®â½…å¼ï¼š`aop:after-returning`æ ‡ç­¾

```xml
<!--
  ä½œâ½¤ï¼š
        â½¤äºé…ç½®åç½®é€šçŸ¥
  å‡ºç°ä½ç½®ï¼š
        å®ƒåªèƒ½å‡ºç°åœ¨aop:aspectæ ‡ç­¾å†…éƒ¨
  å±æ€§ï¼š
        method:â½¤äºæŒ‡å®šåç½®é€šçŸ¥çš„â½…æ³•åç§°
        pointcut:â½¤äºæŒ‡å®šåˆ‡â¼Šç‚¹è¡¨è¾¾å¼
        pointcut-ref:â½¤äºæŒ‡å®šåˆ‡â¼Šç‚¹è¡¨è¾¾å¼çš„å¼•â½¤
        returning:â½¤äºæŒ‡å®šè¿”å›å€¼ç±»å‹
-->
<aop:after-returning method="endLog" pointcut-ref="pointcut1"  returning="reValue"></aop:after-returning>
```

- [S] <font color="red">aop:after-returning</font>
  - [I]  é…ç½®åç½®é€šçŸ¥
  - [I]  ä½ç½®ï¼š<mark style="background: #6FE26FA6;">aop:aspectæ ‡ç­¾å†…éƒ¨</mark>
- [S] <font color="purple">method</font>
  - [I]  æŒ‡å®šåç½®é€šçŸ¥çš„â½…æ³•å
- [S] <font color="purple">pointcut</font>
  - [I] æŒ‡å®šåˆ‡â¼Šç‚¹è¡¨è¾¾å¼
- [S] <font color="purple">pointcut-ref</font>
  - [I] åˆ‡â¼Šç‚¹è¡¨è¾¾å¼çš„å¼•â½¤
- [S] <font color="purple">returning</font>
  - [I] è¿”å›å€¼ç±»å‹
  - [I] å¿…é¡»å­˜åœ¨è¯¥å‚æ•°

- [b] æ‰§â¾æ—¶æœº
  - [i] åç½®é€šçŸ¥çš„æ‰§â¾æ—¶æœºæ˜¯åœ¨åˆ‡â¼Šç‚¹â½…æ³•æ­£å¸¸æ‰§â¾ä¹‹åæ‰§â¾ï¼ˆä¸šåŠ¡æ ¸â¼¼â½…æ³•ï¼‰ï¼Œå½“åˆ‡â¼Šç‚¹â½…æ³•æ‰§â¾äº§â½£å¼‚å¸¸
    ä¹‹åï¼Œåç½®é€šçŸ¥å°±ä¸å†æ‰§â¾äº†ï¼Œâ½½æ˜¯æ‰§â¾å¼‚å¸¸é€šçŸ¥ã€‚
- [b] ç»†èŠ‚
  - [i] åç½®é€šçŸ¥æ—¢å¯ä»¥è·å–åˆ°åˆ‡â¼Šç‚¹â½…æ³•çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥è·å–åˆ‡â¼Šç‚¹â½…æ³•çš„è¿”å›å€¼ã€‚

```java
public class LogUtil {
  public void endLog(JoinPoint joinPoint, String reValue) throws Throwable {
    System.out.println("ending...");
    System.out.println("reValueï¼š" + reValue);//æ–¹æ³•returnçš„å†…å®¹

  }
}
```

## å¼‚å¸¸é€šçŸ¥-Throw
#### aop:after-throwingæ ‡ç­¾
- [l] é…ç½®â½…å¼ï¼š`aop:after-throwing`æ ‡ç­¾

```xml
<!--
  ä½œâ½¤ï¼š
        â½¤äºé…ç½®å¼‚å¸¸é€šçŸ¥
  å‡ºç°ä½ç½®ï¼š
        å®ƒåªèƒ½å‡ºç°åœ¨aop:aspectæ ‡ç­¾å†…éƒ¨
  å±æ€§ï¼š
        method:â½¤äºæŒ‡å®šåç½®é€šçŸ¥çš„â½…æ³•åç§°
        pointcut:â½¤äºæŒ‡å®šåˆ‡â¼Šç‚¹è¡¨è¾¾å¼
        pointcut-ref:â½¤äºæŒ‡å®šåˆ‡â¼Šç‚¹è¡¨è¾¾å¼çš„å¼•â½¤
        arg-names:â½¤äºæŒ‡å®šé€šçŸ¥â½…æ³•çš„å‚æ•°åç§°,è¦æ±‚è¡¨è¾¾å¼ä¸­å¿…é¡»æœ‰æè¿°argsçš„è¯­å¥
        throwing:â½¤äºæŒ‡å®šå¼‚å¸¸é€šçŸ¥ä¸­å¼‚å¸¸çš„å˜é‡åç§°
-->
<aop:after-throwing method="throwLog" pointcut-ref="pointcut1" throwing="e"></aop:after-throwing>
```

- [S] <font color="red">aop:after-throwing</font>
  - [I]  é…ç½®å¼‚å¸¸é€šçŸ¥
  - [I]  ä½ç½®ï¼š<mark style="background: #6FE26FA6;">aop:aspectæ ‡ç­¾å†…éƒ¨</mark>
- [S] <font color="purple">method</font>
  - [I]  æŒ‡å®šåç½®é€šçŸ¥çš„â½…æ³•å
- [S] <font color="purple">pointcut</font>
  - [I] æŒ‡å®šåˆ‡â¼Šç‚¹è¡¨è¾¾å¼
- [S] <font color="purple">pointcut-ref</font>
  - [I] åˆ‡â¼Šç‚¹è¡¨è¾¾å¼çš„å¼•â½¤
- [S] <font color="purple">throwing</font>
  - [I] å¼‚å¸¸é€šçŸ¥ä¸­å¼‚å¸¸çš„å˜é‡åç§°
  - [I] å¿…é¡»å­˜åœ¨è¯¥å‚æ•°

- [b] æ‰§â¾æ—¶æœº
  - [i] å¼‚å¸¸é€šçŸ¥çš„æ‰§â¾æ—¶æœºæ˜¯åœ¨åˆ‡â¼Šç‚¹â½…æ³•ï¼ˆä¸šåŠ¡æ ¸â¼¼â½…æ³•ï¼‰æ‰§â¾äº§â½£å¼‚å¸¸ä¹‹åï¼Œå¼‚å¸¸é€šçŸ¥æ‰§â¾ã€‚å¦‚æœåˆ‡â¼Šç‚¹
    â½…æ³•æ‰§â¾æ²¡æœ‰äº§â½£å¼‚å¸¸ï¼Œåˆ™å¼‚å¸¸é€šçŸ¥ä¸ä¼šæ‰§â¾ã€‚
- [b] ç»†èŠ‚
  - [i] å¼‚å¸¸é€šçŸ¥ä¸ä»…å¯ä»¥è·å–åˆ‡â¼Šç‚¹â½…æ³•æ‰§â¾çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥è·å–åˆ‡â¼Šç‚¹â½…æ³•æ‰§â¾äº§â½£çš„å¼‚å¸¸ä¿¡æ¯ã€‚

```java
public class LogUtil {
    public void throwLog(JoinPoint joinPoint,Throwable e) throws Throwable {
        System.out.println(e);
        System.out.println("throwLog");
    }
}
```
- [!] æŠ›å‡ºçš„å¼‚å¸¸ç”¨Throwableä½œä¸ºå½¢å‚