---
tags: note
status: done
priority: 1
time: 2022-05-23 18:23
things:  "[ğŸ§Š](things:///show?id=JtkDsmtmq6Bd8ZbzKBJTW4)"
---

# IoCçš„ç»¼åˆæ¡ˆä¾‹(CRUD) - çº¯xmlå¼€å‘

## ç»¼åˆæ¡ˆä¾‹ä»‹ç»

### éœ€æ±‚

- [p] å®ç°è´¦æˆ·è¡¨çš„å¢åˆ æ”¹æŸ¥æ“ä½œ

### è¦æ±‚

- é€‰â½¤åŸºäºXMLçš„Springå’ŒMybatisæ•´åˆé…ç½®å®ç°

### æ•°æ®åº“è¡¨ç»“æ„ä»‹ç»
```sql
CREATE TABLE `account` (
	`id` INT ( 11 ) NOT NULL AUTO_INCREMENT,
	`name` VARCHAR ( 20 ) DEFAULT NULL,
	`money` DOUBLE DEFAULT NULL,
PRIMARY KEY ( `id` ) 
) 
```

### æ¡ˆä¾‹çš„å®ç°
#### 1). åˆ›å»ºâ¼¯ç¨‹å¯¼â¼Šåæ ‡
```xml
<properties>
    <maven.compiler.source>11</maven.compiler.source>
    <maven.compiler.target>11</maven.compiler.target>
    <mybatis.version>3.5.9</mybatis.version>
</properties>
<dependencies>

    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-jdbc</artifactId>
        <version>${spring.version}</version>
    </dependency>
    <dependency>
        <groupId>org.mybatis</groupId>
        <artifactId>mybatis</artifactId>
        <version>${mybatis.version}</version>
    </dependency>
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>8.0.29</version>
    </dependency>
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>druid</artifactId>
        <version>1.2.8</version>
    </dependency>
    <dependency>
        <groupId>org.mybatis</groupId>
        <artifactId>mybatis-spring</artifactId>
        <version>2.0.4</version>
    </dependency>
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <version>RELEASE</version>
        <scope>compile</scope>
    </dependency>
</dependencies>
```

#### 2). ç¼–å†™åŸºç¡€ä»£ç 
##### Account
```java
package top.testeru.pojo;

import lombok.Data;

/**
 * @Classname: Account
 * @Description:è´¦æˆ·çš„å®ä½“ç±»
 * @Date: 2022/5/23 18:21
 * @Created by top.testeru
 */
@Data
public class Account {
    private Integer id;
    private String name;
    private Double money;
//çœç•¥set,get,toStringç­‰â½…æ³•
}
```

##### AccountService
```java
package top.testeru.service;

import top.testeru.pojo.Account;

import java.util.List;

/**
 * @Classname: service
 * @Description:
 * @Date: 2022/5/23 18:20
 * @Created by top.testeru
 */
public interface AccountService {
    /**
     * ä¿å­˜
     */
    void save(Account account);
    /**
     * æ ¹æ®idåˆ é™¤
     */
    void delete(Integer id);
    /**
     * æ›´æ–°è´¦æˆ·
     */
    void update(Account account);
    /**
     * æ ¹æ®idæŸ¥è¯¢
     */
    Account findById(Integer id);
    /**
     * æ ¹æ®åç§°æŸ¥è¯¢è´¦æˆ·
     */
    Account findByName(String name);
    /**
     * æŸ¥è¯¢æ‰€æœ‰
     */
    List<Account> findAll();
}
```
##### AccountDao
```java
package top.testeru.dao;

import top.testeru.pojo.Account;

import java.util.List;

/**
 * @Classname: AccountDao
 * @Description:
 * @Date: 2022/5/23 18:22
 * @Created by top.testeru
 */
public interface AccountDao {
    /**
     * ä¿å­˜
     */
    void save(Account account);
    /**
     * æ ¹æ®idåˆ é™¤
     */
    void delete(Integer id);
    /**
     * æ›´æ–°è´¦æˆ·
     */
    void update(Account account);
    /**
     * æ ¹æ®idæŸ¥è¯¢
     */
    Account findById(Integer id);
    /**
     * æ ¹æ®åç§°æŸ¥è¯¢è´¦æˆ·
     */
    Account findByName(String name);
    /**
     * æŸ¥è¯¢æ‰€æœ‰
     */
    List<Account> findAll();
}

```

##### AccountServiceImpl
```java
package top.testeru.service.impl;

import top.testeru.dao.AccountDao;
import top.testeru.pojo.Account;
import top.testeru.service.AccountService;

import java.util.List;

/**
 * @Classname: AccountServiceImpl
 * @Description:
 * @Date: 2022/5/23 18:22
 * @Created by top.testeru
 */
public class AccountServiceImpl implements AccountService {

    private AccountDao accountDao;

    @Override
    public void save(Account account) {
        accountDao.save(account);
    }

    @Override
    public void delete(Integer id) {
        accountDao.delete(id);
    }

    @Override
    public void update(Account account) {
        accountDao.update(account);
    }

    @Override
    public Account findById(Integer id) {
        return accountDao.findById(id);
    }

    @Override
    public Account findByName(String name) {
        return accountDao.findByName(name);
    }

    @Override
    public List<Account> findAll() {
        return accountDao.findAll();
    }
}
```

#### 3). ç¼–å†™mybatisçš„æ˜ å°„é…ç½®

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="top.testeru.dao.AccountDao">
<!--   ä¿å­˜ -->
    <insert id="save" parameterType="top.testeru.pojo.Account">
        INSERT INTO account(name, money) VALUES (#{name},#{name});
    </insert>
<!--    æ›´æ–°è´¦æˆ·-->
    <update id="update" parameterType="top.testeru.pojo.Account">
        UPDATE account SET name = #{name}, money = #{name} WHERE id = #{id};
    </update>
<!--    æ ¹æ®idåˆ é™¤-->
    <delete id="delete" parameterType="int">
        DELETE FROM account WHERE id = #{id}
    </delete>
<!--    æ ¹æ®idæŸ¥è¯¢-->
    <select id="findById" parameterType="int" resultType="top.testeru.pojo.Account">
        select * from account where  id = #{id}
    </select>
<!--    æ ¹æ®åç§°æŸ¥è¯¢è´¦æˆ·-->
    <select id="findByName" parameterType="string" resultType="top.testeru.pojo.Account">
        select * from account where name like CONCAT('%',#{name},'%')
    </select>
<!--    æŸ¥è¯¢æ‰€æœ‰-->
    <select id="findAll" resultType="top.testeru.pojo.Account">
        select * from account
    </select>

</mapper>
```
#### 4). åˆ›å»ºSpringé…ç½®â½‚ä»¶å¹¶å¯¼â¼Šçº¦æŸ
- [b] `xsd`ï¼šå¯¹åº”çš„æ ‡ç­¾çº¦æŸï¼Œè§„å®šäº†æ ‡ç­¾å†…çš„å±æ€§ä»¥åŠå¯¹åº”å«ä¹‰
##### mybatisé…ç½®
######  jdbc.properties
```xml
jdbc.driverClassName=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://110.40.250.165:3307/ssm?characterEncoding=UTF-8&useUnicode=true
jdbc.username=root
jdbc.password=luoluo606709
```
###### bean
```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd 
       http://www.springframework.org/schema/context 
       https://www.springframework.org/schema/context/spring-context.xsd">

    <context:property-placeholder location="classpath:jdbc.properties" />
    <!--é…ç½®æ•°æ®æº-->
    <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
        <!--é©±åŠ¨, url, â½¤æˆ·å,å¯†ç -->
        <property name="driverClassName" value="${jdbc.driverClassName}"/>
        <property name="url" value="${jdbc.url}"/>
        <property name="username" value="${jdbc.username}"/>
        <property name="password" value="${jdbc.password}"/>
    </bean>

    <!--é…ç½®SqlSessionFactory åˆ›å»ºå·¥å‚bean-->
    <bean id="sqlSessionFactory"
          class="org.mybatis.spring.SqlSessionFactoryBean">
        <!--å…³è”æ•°æ®æº-->
        <property name="dataSource" ref="druidDataSource"/>
        <!--è®¾ç½®pojoçš„åˆ«å-->
        <property name="typeAliasesPackage" value="top.testeru.pojo"/>
    </bean>
    <!--é…ç½®Mapperæ˜ å°„æ‰«æ, æ‰«ææ‰€æœ‰çš„Mapper.xmlâ½‚ä»¶ä¸ â½£æˆdaoæ¥â¼çš„å®ç°ç±»å¯¹è±¡å­˜åˆ°IOCå®¹å™¨ä¸­-->
    <!--   MapperScanner æ‰«æå¯¹åº”çš„mapperæ¥å£ï¼Œé…ç½®åŒ…åå³å¯  -->
    <bean id="scannerConfigurer"
          class="org.mybatis.spring.mapper.MapperScannerConfigurer">
        <!--å¯çœç•¥-->
        <property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"/>
        <!--daoæ˜ å°„æ‰«æ-->
        <property name="basePackage" value="top.testeru.dao"/>
    </bean>
</beans>
```
![](https://cdn.jsdelivr.net/gh/testeru-top/images/spring/202205232031857.png)


##### service-beanå¯¼å…¥
###### æ­¥éª¤1ï¼š AccountServiceImpl
- [b] setæ–¹æ³•æ³¨å…¥å¯¹åº”æˆå‘˜å˜é‡
```java
public class AccountServiceImpl implements AccountService {

    private AccountDao accountDao;

    public void setAccountDao(AccountDao accountDao) {
        this.accountDao = accountDao;
    }
}
```
###### æ­¥éª¤2ï¼šbean 
```xml
<!--    serviceå¯¼å…¥-->
<bean id="accountService" class="top.testeru.service.impl.AccountServiceImpl">
<!--    nameä¸ºserviceå®ç°ç±»ä¸­çš„æˆå‘˜å˜é‡å  refå¯¹åº”çš„ä¸ºAccountDaoæ¥å£-->
    <property name="accountDao" ref="accountDao"></property>
</bean>
```

>åŠ¨æ€æ‰«æmapperæ¥å£çš„å®ç°ç±»å¯¹è±¡ï¼Œå®ç°ç±»å¯¹è±¡ä¼šè‡ªåŠ¨å®ç°åˆ° Spring çš„å®¹å™¨ä¸­
>é€šè¿‡classæ–‡ä»¶åå°„çš„ä»£ç†å¯¹è±¡ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡å»è¯»åŒåçš„xmlæ–‡ä»¶ã€‚å°±å¯ä»¥å®ç°æ“ä½œxmlæ–‡ä»¶ä¸­çš„æ“ä½œè¯­å¥

#### 5). ç¼–å†™æµ‹è¯•
```java
package top.testeru.service;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import top.testeru.pojo.Account;
import top.testeru.service.impl.AccountServiceImpl;

import java.util.List;

import static org.junit.jupiter.api.Assertions.*;

/**
 * @Classname: AccountServiceTest
 * @Description:
 * @Date: 2022/5/24 10:10
 * @Created by top.testeru
 */
class AccountServiceTest {
    AccountServiceImpl accountService;
    @BeforeEach
    void setUp() {
        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");
        accountService = context.getBean("accountService", AccountServiceImpl.class);
    }

    @Test
    void save() {
        Account account = new Account();
        account.setName("gaigai");
        account.setMoney(88.6);
        accountService.save(account);
    }

    @Test
    void delete() {
        accountService.delete(1);
    }

    @Test
    void update() {
        Account account = new Account();
        account.setId(1);
        account.setName("gaigaiNew");
        account.setMoney(66.9);
        accountService.update(account);
    }

    @Test
    void findById() {
        Account account = accountService.findById(2);
        System.out.println(account);
    }

    @Test
    void findByName() {
        Account account = accountService.findByName("2");
        System.out.println(account);
    }

    @Test
    void findAll() {
        List<Account> all = accountService.findAll();
        all.forEach(System.out::println);
    }
}
```