---
tags: note
status: done
priority: 7
time: 2022-05-25 11:42
things:  "[ğŸ§Š](things:///show?id=JtkDsmtmq6Bd8ZbzKBJTW4)"
---

## æ³¨è§£å¯¹åº”xml

### @Configuration
- æ ‡è¯†å½“å‰ç±»æ˜¯`Spring`çš„â¼€ä¸ªé…ç½®ç±»
### @ComponentScan
- æ›¿ä»£`xml`ä¸­çš„ `<context:component-scan/>`
### @Import
- å¼•â¼Šå…¶ä»–é…ç½®ç±»,è¢«å¼•â¼Šçš„é…ç½®ç±»å¯ä»¥ä¸åŠ `@Configuration`æ³¨è§£
### @PropertySource
- å¼•â¼Šå¤–éƒ¨`properties`â½‚ä»¶ï¼Œæ³¨æ„åŠ `classpath`
### @Value
- å¯¹æˆå‘˜å˜é‡èµ‹å€¼
### @Bean
- å°†â¼€ä¸ªâ½…æ³•çš„è¿”å›å€¼å¯¹è±¡åŠ â¼Šåˆ°`Spring`çš„å®¹å™¨å½“ä¸­ç®¡ç†
### @Qualifier
- å¯ä»¥ä½¿â½¤åœ¨â½…æ³•å‚æ•°ä¸Šï¼Œè¡¨æ˜å¯¹åº”çš„å½¢å‚å¼•â¼Š/æ³¨â¼Šçš„å¯¹è±¡ç±»å‹




![](https://cdn.jsdelivr.net/gh/testeru-top/images/spring/202205241618543.png)
### é…ç½®ä¿®æ”¹
#### serviceåŒ…æ‰«æ
- [i] xmlé…ç½®æ–¹å¼
```xml
<context:component-scan base-package="top.testeru.service"></context:component-scan>
```
- [p] å¯¹åº”æ³¨è§£æ–¹å¼
```java
//@ComponentScan(basePackages = {"top.testeru.service"})
@ComponentScan("top.testeru.service")
public class SpringConfig {}
```
#### é…ç½®æ•°æ®æº
- [i] xmlé…ç½®æ–¹å¼
```xml
 <!--é…ç½®æ•°æ®æº-->
<bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
    <!--é©±åŠ¨, url, â½¤æˆ·å,å¯†ç -->
    <property name="driverClassName" value="${jdbc.driverClassName}"/>
    <property name="url" value="${jdbc.url}"/>
    <property name="username" value="${jdbc.username}"/>
    <property name="password" value="${jdbc.password}"/>
</bean>
```

- [p] å¯¹åº”æ³¨è§£æ–¹å¼
```java
@ComponentScan(basePackages = {"top.testeru.service"})
//@ComponentScan("top.testeru.service")
public class SpringConfig {

    @Bean("dataSource")
    public DruidDataSource getDruidDataSource() {
        DruidDataSource dataSource = new DruidDataSource();
        dataSource.setUrl("jdbc:mysql://110.40.250.165:3307/ssm?characterEncoding=UTF-8&useUnicode=true");
        dataSource.setDriverClassName("com.mysql.cj.jdbc.Driver");
        dataSource.setUsername("root");
        dataSource.setPassword("luoluo606709");
        return dataSource;
    }
}
```


#### é…ç½®å·¥å‚bean
- [i] xmlé…ç½®æ–¹å¼
```xml
<bean id="sqlSessionFactory"
          class="org.mybatis.spring.SqlSessionFactoryBean">
    <!--å…³è”æ•°æ®æº-->
    <property name="dataSource" ref="druidDataSource"/>
    <!--è®¾ç½®pojoçš„åˆ«å-->
    <property name="typeAliasesPackage" value="top.testeru.pojo"/>
</bean>
```

- [p] å¯¹åº”æ³¨è§£æ–¹å¼
```java
@ComponentScan(basePackages = {"top.testeru.service"})
//@ComponentScan("top.testeru.service")
public class SpringConfig {
    @Bean
    public SqlSessionFactoryBean getSqlSessionFactoryBean(
            @Qualifier("dataSource") DataSource dataSource){
        SqlSessionFactoryBean factoryBean = new SqlSessionFactoryBean();
        factoryBean.setDataSource(dataSource);
        factoryBean.setTypeAliasesPackage("top.testeru.pojo");
        return factoryBean;
    }
}
```

#### é…ç½®Mapperæ˜ å°„æ‰«æ
- [i] xmlé…ç½®æ–¹å¼
```xml
<bean id="scannerConfigurer"
          class="org.mybatis.spring.mapper.MapperScannerConfigurer">
    <!--å¯çœç•¥-->
    <property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"/>
    <!--daoæ˜ å°„æ‰«æ-->
    <property name="basePackage" value="top.testeru.dao"/>
</bean>
```
- [p] å¯¹åº”æ³¨è§£æ–¹å¼
```java
@ComponentScan(basePackages = {"top.testeru.service"})
//@ComponentScan("top.testeru.service")
public class SpringConfig {
    @Bean
    public MapperScannerConfigurer getMapperScannerConfigurer(){
        MapperScannerConfigurer configurer = new MapperScannerConfigurer();
        configurer.setBasePackage("top.testeru.dao");
        return configurer;
    }
}
```


### æµ‹è¯•
```java
@ContextConfiguration(classes = SpringConfig.class)
class AccountServiceTest {}
```

### ä¼˜åŒ–
- å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œæœ€åæ±‡æ€»åˆ°`SpringConfig`å†…
#### SpringConfig

```java
@Configuration//ä½œä¸ºSpringæ¡†æ¶çš„ä¸»é…ç½®â½‚ä»¶
//@ComponentScan(basePackages = {"top.testeru.service"})
@ComponentScan("top.testeru.service")//å¼€å¯Springå®¹å™¨çš„æ³¨è§£æ‰«æ
@Import({JdbcConfig.class,BeanConfig.class})//å¯¼â¼Šâ¼¦é…ç½®â½‚ä»¶
public class SpringConfig {
}
```

#### JdbcConfig

```java
@PropertySource("classpath:jdbc.properties")//â½¤äºæŒ‡å®šä¸æ•°æ®åº“ç›¸å…³é…ç½®çš„é…ç½®â½‚ä»¶
public class JdbcConfig {

    @Value("${jdbc.driver}")
    private String driver;

    @Value("${jdbc.url}")
    private String url;
    @Value("${jdbc.username}")
    private String username;
    @Value("${jdbc.password}")
    private String password;


    @Bean("dataSource")
    public DruidDataSource getDruidDataSource(){
        DruidDataSource dataSource = new DruidDataSource();
        dataSource.setUrl(url);
        dataSource.setDriverClassName(driver);
        dataSource.setUsername(username);
        dataSource.setPassword(password);
        return dataSource;
    }

}
```


#### BeanConfig
```java
//â½¤äºé…ç½®ä¸Mybatisç›¸å…³çš„é…ç½®
public class BeanConfig {
    @Bean
    public SqlSessionFactoryBean getSqlSessionFactoryBean(
            @Qualifier("dataSource") DataSource dataSource){
        SqlSessionFactoryBean factoryBean = new SqlSessionFactoryBean();
        //é…ç½®ç›¸å…³ä¿¡æ¯(æ•°æ®æº)
        factoryBean.setDataSource(dataSource);
        //é…ç½®ç›¸å…³ä¿¡æ¯(pojoåˆ«åæ˜ å°„)
        factoryBean.setTypeAliasesPackage("top.testeru.pojo");
        return factoryBean;
    }
//    é…ç½®Mapperæ˜ å°„æ‰«æ, æ‰«ææ‰€æœ‰çš„Mapper.xmlâ½‚ä»¶ä¸ â½£æˆdaoæ¥â¼çš„å®ç°ç±»å¯¹è±¡å­˜åˆ°IOCå®¹å™¨ä¸­
    @Bean
    public MapperScannerConfigurer getMapperScannerConfigurer(){
        MapperScannerConfigurer configurer = new MapperScannerConfigurer();
        configurer.setBasePackage("top.testeru.dao");
        return configurer;
    }
}
```