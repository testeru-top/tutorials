# è·å–è‡ªå®šä¹‰å€¼å®æˆ˜
- æ³¨å…¥æ™®é€šå­—ç¬¦
- æ³¨å…¥é…ç½®æ–‡ä»¶çš„å±æ€§å€¼
	- ${â€¦} ä¸»è¦ç”¨äºåŠ è½½å¤–éƒ¨å±æ€§æ–‡ä»¶ä¸­çš„å€¼
	- å±æ€§å€¼ä¸ºString
	- å±æ€§å€¼ä¸ºList
	- å±æ€§å€¼ä¸ºMap
- 
- 
## éœ€æ±‚ä¸€
åœ¨é…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰mapæ ¼å¼å†…å®¹ï¼Œ `value` ä¸º==String==ç±»å‹çš„ï¼Œåœ¨ä»£ç ä¸­è·å– `value` 
ä¾‹å¦‚ï¼špropertiesæ–‡ä»¶é…ç½®
```
android.deviceName=8c5f5f92
```
è·å–å¯¹åº”deviceNameçš„å€¼
#### åˆ†æ
- 1.åˆ›å»º `springboot` é…ç½®æ–‡ä»¶
- 2.åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™å¯¹åº” `map`
- 3.ä»£ç ä¸­æ ¹æ® `key` è·å–å¯¹åº” `value`

### å®ç°æ­¥éª¤
1. åœ¨ `controller` åŒ…ä¸‹çš„å®ç°ç±»è¿›è¡Œå¯¹åº”å€¼çš„è·å–
2. å£°æ˜è·å–çš„å˜é‡å€¼åä¸º `deviceName`
3. åœ¨æˆå‘˜å˜é‡ä¸Šæ·»åŠ æ³¨è§£ `value`
4. åœ¨æ³¨è§£ `value` å†…å¡«å†™ `key` è·¯å¾„ `${android.deviceName}`
>å¦‚æœä¸æ·»åŠ  ${} ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿï¼Ÿ

- æ— æ³•æ­£å¸¸è§£æï¼Œç›´æ¥æ³¨å…¥æ™®é€šå­—ç¬¦
### ä»£ç 

#### ç¼–å†™Controller

```java
@RestController
public class ValueController {


	@Value("${android.deviceName}")
	private String deviceName;
    
	@GetMapping(value = "device")
	String getStrWithProperty() {
		System.out.println(deviceName);
		return deviceName;
	}
}
```

![](https://gitee.com/javaTesteru/picgo/raw/master/images/hogwarts/202204191704574.png)

### æ€»ç»“
- éœ€è¦ç”¨${}æŠŠkeyåŒ…è£¹èµ·æ¥
- ${â€¦} ä¸»è¦ç”¨äºåŠ è½½å¤–éƒ¨å±æ€§æ–‡ä»¶ä¸­çš„å€¼


## éœ€æ±‚äºŒ
åœ¨é…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰mapæ ¼å¼å†…å®¹ï¼Œ `value` ä¸º==Map==ç±»å‹çš„ï¼Œåœ¨ä»£ç ä¸­è·å–å…¶ `value` 
ä¾‹å¦‚ï¼špropertiesæ–‡ä»¶é…ç½®
```
android.capabilities={platformName:"Android",platformVersion:"12",deviceName: "8c5f5f92",automationName:"UiAutomator2",appActivity:".MainActivity",appPackage:"io.cloudgrey.the_app"}
```
è·å–å¯¹åº”capabilitiesçš„ç±»å‹ä¸ºmapå€¼
#### åˆ†æ
- 1.åˆ›å»º `springboot` é…ç½®æ–‡ä»¶
- 2.åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™å¯¹åº” `map`
- 3.ä»£ç ä¸­æ ¹æ® `key` è·å–å¯¹åº” `value`
### å®ç°æ­¥éª¤
1. åœ¨ `controller` åŒ…ä¸‹çš„å®ç°ç±»è¿›è¡Œå¯¹åº”å€¼çš„è·å–
2. å£°æ˜è·å–çš„å˜é‡å€¼åä¸º `appMap`
3. åœ¨æˆå‘˜å˜é‡ä¸Šæ·»åŠ æ³¨è§£ `value`
4. åœ¨æ³¨è§£ `value` å†…å¡«å†™ `key` è·¯å¾„ `@Value("#{${android.capabilities}}")`

### ä»£ç 

#### ç¼–å†™Controller

```java
@RestController  
public class ValueController {  
  
    @Value("#{${android.capabilities}}")  
    private Map<String,String> appMap;
    
    @GetMapping(value = "android")  
	Map<String,String> getMapWithProperty() {  
		System.out.println(appMap);  
	  
		System.out.println(appMap.get("deviceName"));  
		return appMap;  
	}
}
```
![](https://gitee.com/javaTesteru/picgo/raw/master/images/hogwarts/202204191712272.png)

### æ€»ç»“
- è¿”å›ç»™å‰ç«¯çš„ä¸ºæ‰€æœ‰çš„valueå­—ç¬¦ä¸²
  - æ ¼å¼ä¹±ï¼Œä¸æ˜¯æœŸæœ›æ•ˆæœ


### ä¼˜åŒ–
æƒ³è¦è¿”å›çš„å†…å®¹ä¸º`map`ï¼Œå³`json`æ ¼å¼ä½“
#### è§£å†³åŠæ³•
åœ¨è¯·æ±‚çš„`mapping`æ³¨è§£å†…æ·»åŠ å¯¹åº”ç±»å‹å…³é”®å­— `produces`
#### å¯¹åº”ä»£ç 
```java
@RestController  
public class ValueController {  

    @Value("${android.deviceName}")  
    private String deviceName;  
  
    @Value("#{${android.capabilities}}")  
    private Map<String,String> appMap;
    
    @GetMapping(value = "android",produces = "application/json")  
	Map<String,String> getMapWithProperty() {  
		System.out.println(appMap);  
	  
		System.out.println(appMap.get("deviceName"));  
		return appMap;  
	}
}
```


![](https://gitee.com/javaTesteru/picgo/raw/master/images/hogwarts/202204191712000.png)




## éœ€æ±‚ä¸‰
åœ¨é…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰mapæ ¼å¼å†…å®¹ï¼Œ `value` ä¸º==Map==ç±»å‹çš„ï¼Œåœ¨ä»£ç ä¸­è·å–å…¶`value`å†…å…·ä½“`key`çš„å€¼ 
ä¾‹å¦‚ï¼špropertiesæ–‡ä»¶é…ç½®
```
android.capabilities={platformName:"Android",platformVersion:"12",deviceName: "8c5f5f92",automationName:"UiAutomator2",appActivity:".MainActivity",appPackage:"io.cloudgrey.the_app"}
```
è·å–å¯¹åº”`capabilities`çš„`key`ä¸º`automationName`çš„å€¼
#### åˆ†æ
- 1.åˆ›å»º `springboot` é…ç½®æ–‡ä»¶
- 2.åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™å¯¹åº” `map`
- 3.ä»£ç ä¸­æ ¹æ® `key` è·å–å¯¹åº” `value`å†…çš„keyåè·å–
### å®ç°æ­¥éª¤
1. åœ¨ `controller` åŒ…ä¸‹çš„å®ç°ç±»è¿›è¡Œå¯¹åº”å€¼çš„è·å–
2. å£°æ˜è·å–çš„å˜é‡å€¼åä¸º `appMap`
3. åœ¨æˆå‘˜å˜é‡ä¸Šæ·»åŠ æ³¨è§£ `value`
4. åœ¨æ³¨è§£ `value` å†…å¡«å†™ `key` è·¯å¾„

 `#{${android.capabilities}.automationName}`

### ä»£ç 

#### ç¼–å†™Controller


```java

@RestController  
public class ValueController {
	@Value("#{${android.capabilities}.automationName}")  
	private String mapValue;
	
	@GetMapping(value = "automation")  
	String getMapValueWithProperty() {
		System.out.println(mapValue);
		return mapValue;  
	}
}
```



![](https://gitee.com/javaTesteru/picgo/raw/master/images/hogwarts/202204191724479.png)



## éœ€æ±‚å››
è·å–å½“å‰ç³»ç»Ÿå±æ€§`os.name`
#### åˆ†æ
- [[SpELè¡¨è¾¾å¼]]

### å®ç°æ­¥éª¤

`#{systemProperties['os.name']}`

### ä»£ç 

#### ç¼–å†™Controller
```java
@RestController  
public class ValueController {
	@Value("#{systemProperties['os.name']}")  
	// æ³¨å…¥æ“ä½œç³»ç»Ÿå±æ€§  
	String systemPropertie;
	
	@GetMapping(value = "getSystem")  
	String getSystemValue() {  
		//Mac OS X  
		System.out.println(systemPropertie);  
		return systemPropertie;  
	}
}
```





## #{..}å’Œ${â€¦}åŒºåˆ«
### ${â€¦}
>æ³¨å…¥çš„æ˜¯å¤–éƒ¨å‚æ•°å¯¹åº”çš„property

- æ¨¡ç‰ˆï¼š`${property:default_value}`
- è·å–å±æ€§æ–‡ä»¶ä¸­å¯¹åº”çš„å€¼
- è‹¥å±æ€§æ–‡ä»¶ä¸­æ²¡æœ‰è¿™ä¸ªå±æ€§
    ```java
    @RestController
    public class ValueController {

        @Value("${ios.udid}")
        private String iosUdid;
     }
    ```
  - åˆ™ä¼šæŠ¥é”™
      ```
      beans.factory.BeanCreationException:
      Error creating bean with name 'valueController': 
      Injection of autowired dependencies failed; 
      nested exception is java.lang.IllegalArgumentException: 
      Could not resolve placeholder 'ios.udid'...
      ```
- è§£å†³æ–¹æ¡ˆï¼š
  - é€šè¿‡èµ‹äºˆé»˜è®¤å€¼è§£å†³
```java
	@RestController
	public class ValueController {

		@Value("${ios.udid:ABCDEF01-0123-ABCD-0123-ABCDEF012345}")
		private String iosUdid;
	}
```

- ä¸Šé¢ğŸ‘†ä»£ç çš„å«ä¹‰è¡¨ç¤ºå‘`bean`çš„å±æ€§ä¸­æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„`ios.udid`å±æ€§çš„å€¼ï¼Œå¦‚æœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰`ios.udid`å±æ€§ï¼Œåˆ™å‘`bean`çš„å±æ€§ä¸­æ³¨å…¥é»˜è®¤å€¼`ABCDEF01-0123-ABCD-0123-ABCDEF012345`
### #{â€¦}
>SpELè¡¨è¾¾å¼å¯¹åº”çš„å†…å®¹
>è¡¨è¾¾å¼è¯­è¨€ä¸€èˆ¬æ˜¯ç”¨æœ€ç®€å•çš„å½¢å¼å®Œæˆæœ€ä¸»è¦çš„å·¥ä½œï¼Œå‡å°‘æˆ‘ä»¬çš„å·¥ä½œé‡

- æ¨¡ç‰ˆï¼š`#{obj.property ?:Â default_value }`
	- Â default_valueï¼šå‰é¢çš„å€¼ä¸ºç©ºæ—¶çš„é»˜è®¤å€¼

