---
tags: note
status: done
priority: 1
time: 2022-05-17 12:26
things:  "[ğŸ§Š](things:///show?id=JtkDsmtmq6Bd8ZbzKBJTW4)"
---


#### å¼•å…¥ä¾èµ–
```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-jdbc</artifactId>
    </dependency>
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>8.0.29</version>
        <scope>runtime</scope>
    </dependency>
    <dependency>
        <groupId>tk.mybatis</groupId>
        <artifactId>mapper</artifactId>
        <version>4.1.5</version>
    </dependency>
</dependencies>
```


- æ·»åŠ äº† spring-boot-starter-jdbcã€MySQL é©±åŠ¨ã€‚
#### é…ç½®æ•°æ®æº
- åœ¨ `src/main/resources` ç›®å½•ä¸‹ `application.yml`å†…è¿›è¡Œé…ç½®
```yml
spring:
  datasource:
    url: jdbc:mysql://110.40.250.165:3307/shop?characterEncoding=UTF-8&useUnicode=true&nullCatalogMeansCurrent=true
    name: root
    password: luoluo606709

```

- é€šè¿‡ä¸Šé¢çš„å±æ€§é…ç½®æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯åï¼Œ Spring Boot å°±å¯ä»¥è‡ªåŠ¨é…ç½®æ•°æ®æºäº†
>Spring Boot ä¼šè‡ªåŠ¨åŠ è½½ spring.datasource.* ç›¸å…³é…ç½®ï¼Œæ•°æ®æºå°±ä¼šè‡ªåŠ¨æ³¨å…¥åˆ° sqlSessionFactory ä¸­ï¼Œ
> sqlSessionFactory ä¼šè‡ªåŠ¨æ³¨å…¥åˆ° Mapper ä¸­ï¼Œä½ ä¸€åˆ‡éƒ½ä¸ç”¨ç®¡äº†ï¼Œç›´æ¥æ‹¿èµ·æ¥ä½¿ç”¨å°±è¡Œäº†

## æ·»åŠ æ‰«æè·¯å¾„
- åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ å¯¹ mapper åŒ…æ‰«æ`@MapperScan`ã€Œä½¿ç”¨çš„æ˜¯å¯åŠ¨ç±»æ³¨è§£ã€
```java

@SpringBootApplication
@MapperScan("top.testeru.sbm.dao")
public class SbmApplication {

    public static void main(String[] args) {
        SpringApplication.run(SbmApplication.class, args);
    }

}


```
>æˆ–è€…ç›´æ¥åœ¨ Mapper ç±»ä¸Šé¢æ·»åŠ æ³¨è§£@Mapperï¼Œå»ºè®®ä½¿ç”¨ä¸Šé¢é‚£ç§ï¼Œä¸ç„¶æ¯ä¸ª mapper åŠ ä¸ªæ³¨è§£ä¹ŸæŒºéº»çƒ¦çš„

- ç›¸å½“äº MyBatis çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶å†…æ·»åŠ mappersæ ‡ç­¾ï¼š
```xml

 <mappers>
   <!-- æ‰«ææŒ‡å®šçš„åŒ… -->
   <package name="com.example.mapper"/>
 </mappers>
 
```
- `@Mapper `ä¸€å®šè¦æœ‰ï¼Œå¦åˆ™ `Mybatis` æ‰¾ä¸åˆ° `mapper`ã€‚ä½†æ˜¯å¯åŠ¨ç±»æœ‰äº† `MapperScan` å¯ä»¥æ›¿æ¢ `Mapper`
## é…ç½® MyBatis
- `application.yml`é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š
```yml
mybatis:
  type-aliases-package: top.testeru.sbm.entity
  configuration:
    use-actual-param-name: true
  # æ˜ å°„æ–‡ä»¶çš„è·¯å¾„ ï¼Œæ”¯æŒ Ant é£æ ¼çš„é€šè‡ªå·±ç¬¦ï¼Œ å¤šä¸ªç›®å·±ç›´å¯ä»¥ä½¿ç”¨è‹±æ–‡é€—å·éš”å¼€
  mapper-locations: classpath:mapper/*.xml

```

é’ˆå¯¹ Example å°è£…äº†ä¸€ä¸ª ExampleWrapperï¼Œå¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨æ–¹ä¾¿çš„ä½¿ç”¨ Example æ–¹æ³•ã€‚
## å®ä½“ç±»ç»§æ‰¿BaseEntity

- è¿›è¡Œåºåˆ—åŒ–
```java
package top.testeru.sbm.entity;

import javax.persistence.Column;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import java.io.Serializable;
import java.util.Date;

/**
 * @program: springboot-turorials
 * @author: testeru.top
 * @description:
 * @Version 1.0
 * @create: 2022/5/17 4:17 PM
 */

public class BaseEntity implements Serializable {
    private static final long serialVersionUID = 498820763181265L;

}

```

## mapperæ¥å£
- é€šç”¨mapperï¼ŒåŸºæœ¬æ–¹æ³•éƒ½æœ‰
```java
package top.testeru.sbm.common;

import tk.mybatis.mapper.common.IdsMapper;
import tk.mybatis.mapper.common.Mapper;
import tk.mybatis.mapper.common.MySqlMapper;
import top.testeru.sbm.entity.BaseEntity;

/**
 * @program: springboot-turorials
 * @author: testeru.top
 * @description: æ–°å»ºâ¼€ä¸ªé€šâ½¤Mapperç»§æ‰¿Mapperã€MySqlMapperï¼Œç‚¹å‡»è¿›å»çœ‹
 * è¢«Mapperç»§æ‰¿çš„BaseMapperâ¾¥â¾¯æœ‰è¿˜æœ‰å¾ˆå¤šå¢åˆ æ”¹æŸ¥çš„â½…æ³•
 * @Version 1.0
 * @create: 2022/5/17 2:38 PM
 */
public interface MySqlExtensionMapper<T extends BaseEntity> extends Mapper<T>, MySqlMapper<T>, IdsMapper<T> {
}

```
## å¢åˆ æ”¹æŸ¥

### controller
```java
@RestController
public class UserController {
    @Autowired
    UserService userService;

//    ç”¨æˆ·æ³¨å†Œ
    @PostMapping(value = "/reg",produces = "application/json")
    String registerUser(@RequestBody User user){
        return userService.register(user);
    }
    //    ç”¨æˆ·æ›´æ”¹ä¿¡æ¯
    @PostMapping(value = "/update",produces = "application/json")
    String updateUser(@RequestBody User user){
        return userService.update(user);
    }

    //    ç”¨æˆ·æ³¨é”€
    @PostMapping(value = "/dele",produces = "application/json")
    String deleteUser(@RequestBody User user){
        return userService.delete(user);
    }
    //    ç”¨æˆ·æŸ¥è¯¢
    @PostMapping(value = "/find",produces = "application/json")
    List<User> findUser(@RequestBody User user){
        return userService.find(user);
    }
}
```


### service
```java
public interface UserService {
    String register(User user);

    List<User> find(User user);

    String delete(User user);

    String update(User user);
}

```

#### impl
```java
package top.testeru.sbm.service.impl;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import tk.mybatis.mapper.entity.Example;
import top.testeru.sbm.dao.UserMapper;
import top.testeru.sbm.entity.User;
import top.testeru.sbm.service.UserService;

import java.util.Date;
import java.util.List;

/**
 * @program: springboot-turorials
 * @author: testeru.top
 * @description:
 * @Version 1.0
 * @create: 2022/5/17 2:38 PM
 */

@Service
public class UserServiceImpl implements UserService {

    @Autowired
    UserMapper userMapper;


    @Override
    public String register(User user) {
        List<User> byNameUser = findByName(user.getUserName());
        byNameUser.forEach(System.out::println);
        if(byNameUser.size()==0){
            System.out.println(user);
            user.setCreateTime(new Date());
            user.setUpdateTime(new Date());
            user.setFlag(0);
            //ä¿å­˜ä¸€ä¸ªå®ä½“ï¼Œnullçš„å±æ€§ä¸ä¼šä¿å­˜ï¼Œä¼šä½¿ç”¨æ•°æ®åº“é»˜è®¤å€¼
            int insertNum = userMapper.insertSelective(user);
            System.out.println("æ’å…¥ " + insertNum + "æ¡æ•°æ®");
            if(insertNum >0){
                return "æ³¨å†ŒæˆåŠŸ";
            }
            return "æ³¨å†Œå¤±è´¥";
        }else {
            return "è¯¥ç”¨æˆ·åå·²ç»æ³¨å†Œ";
        }

    }

    @Override
    public List<User> find(User user) {
        return findByName(user.getUserName());

    }


    /**
     * æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾ç”¨æˆ·
     * @param userName
     * @return
     */
    private List<User> findByName(String userName) {
        Example example = new Example(User.class);
        Example.Criteria criteria = example.createCriteria();
        criteria.andEqualTo("userName", userName);
        criteria.andEqualTo("flag", 0);
        List<User> userList = userMapper.selectByExample(example);

        return userList;


    }

    @Override
    public String delete(User user) {
        user.setFlag(1);
        user.setEmail(null);
        user.setPassword(null);
        return upAndDele(user,"åˆ é™¤ç”¨æˆ·");
    }



    @Override
    public String update(User user) {
        return upAndDele(user,"æ›´æ”¹å¯†ç ");
    }


    private String upAndDele(User user, String str) {
        List<User> byNameUser = findByName(user.getUserName());
        if(byNameUser.size()!=0){
            //æ”¾å…¥ä¸»é”®
            user.setId(byNameUser.get(0).getId());
            //æ›´æ–°çš„æ—¶é—´
            user.setUpdateTime(new Date());
            System.out.println(user);
            int updateNum = userMapper.updateByPrimaryKeySelective(user);
            System.out.println("æ›´æ”¹ " + updateNum + "æ¡æ•°æ®");
            if(updateNum >0){
                return str + "æˆåŠŸ";
            }
            return str + "å¤±è´¥";
        }else {
            return "è¯¥ç”¨æˆ·ä¸å­˜åœ¨";
        }
    }
}
```
