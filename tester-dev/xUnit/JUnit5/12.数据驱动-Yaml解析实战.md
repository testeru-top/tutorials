---
tags: note
status: done
priority: 1
time: 2022-06-20 16:20
things:  "[ğŸ§Š](things:///show?id=JtkDsmtmq6Bd8ZbzKBJTW4)"
---
# yamlè§£æå°è£…
- yamlæ–‡ä»¶ååºåˆ—åŒ–
```java
private static Sum getSumData() {
    Sum sum = null;
    try {
        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());
        TypeReference<Sum> typeReference = new TypeReference<>() {
        };
        sum = mapper.readValue(new File("src/test/resources/sum.yaml"), typeReference);
    } catch (IOException e) {
        e.printStackTrace();
    }
    return sum;
}
```
# yamlæ–‡ä»¶è§£æä¸ºå¯¹è±¡
```java
    @ParameterizedTest
    @MethodSource("sumData")
    void sumTest(Data data){
        System.out.println(data);
        MySUT mySUT = new MySUT("yaml Calculator");
        int result = mySUT.sum(data.getA(), data.getB());
        //hamcrestæ–­è¨€æ•°å­—è®¡ç®—
        assertThat(data.getMessage(),result, equalTo(data.getResult()));
    }
    //å‚æ•°åŒ–å¯¹è±¡
    static Stream<Data> sumData(){
        return getSumData().getDatas().stream();
    }

```
# yamlæ–‡ä»¶è§£æä¸ºArguments
>æµ‹è¯•æ–¹æ³•çš„å‚æ•°ä¸ºå¯¹è±¡ï¼Œå‚æ•°åŒ–å†…å®¹ä¸ºé›†åˆçš„Arguments
##### collectioné›†åˆ
- yamlæ–‡ä»¶è§£æä¸ºé›†åˆè¿”å›å…·ä½“å€¼

```java
//å‚æ•°åŒ–Arguments
static Collection<Arguments> sumArgData(){
    List<Data> dataList = getSumData().getDatas();
    Collection<Arguments> argumentsCollection = new ArrayList<>();
    dataList.forEach(data -> {
                        Arguments arguments = Arguments.arguments(
                            data.getA(), data.getB(), data.getResult(), data.getMessage()
                        );
                        argumentsCollection.add(arguments);
                    });
    return argumentsCollection;
}
```
### ä¸€ã€æ–¹æ³•çš„å‚æ•°ä¸ºå¤šä¸ªå¯¹åº”å˜é‡
```java

    //æ–¹æ³•çš„å‚æ•°ä¸ºå¤šä¸ªå¯¹åº”å˜é‡
    @ParameterizedTest(name = "[{index}] {0} + {1} = {2}")
    @MethodSource("sumArgData")
    void sumArgTest(int a, int b, int re, String message){

        MySUT mySUT = new MySUT("yaml Calculator");
        int result = mySUT.sum(a, b);
        //hamcrestæ–­è¨€æ•°å­—è®¡ç®—
        assertThat(message, result, equalTo(re));
    }
```
### äºŒã€æ–¹æ³•çš„å‚æ•°ä¸ºå¯¹è±¡
- è‡ªå®šä¹‰ `@AggregateWith` æ³¨è§£ã€Œå…è®¸æŒ‡å®š `ArgumentsAggregator`ã€çš„å®ç°ç±»
  - å®ç°`ArgumentsAggregator`æ¥å£çš„ `aggregateArguments`


>å†æŠŠé›†åˆé‡Œé¢çš„æ¯ä¸ªå€¼ï¼Œæ”¾å…¥æ–¹æ³•çš„å¯¹è±¡ä¸­ã€‚
```java
 //    æ–¹æ³•å‚æ•°ä¸ºå¯¹è±¡
@ParameterizedTest(name = "[{index}] {0} + {1} = {2}")
@MethodSource("sumArgData")
void sumArgTest(@AggregateWith(SumAggregator.class)Data data){
    System.out.println(data);
    MySUT mySUT = new MySUT("yaml Calculator");
    int result = mySUT.sum(data.getA(), data.getB());
    //hamcrestæ–­è¨€æ•°å­—è®¡ç®—
    assertThat(data.getMessage(),result, equalTo(data.getResult()));
}
```


#### ArgumentsAggregatorå®ç°ç±»
- `ArgumentsAggregator`
    - ä½œç”¨ï¼šå°† `@ParameterizedTest` æ–¹æ³•çš„å•ä¸ªæä¾›çš„å‚æ•°èšåˆåˆ°å•ä¸ªå¯¹è±¡ä¸­

```java
public class SumAggregator implements ArgumentsAggregator {
    @Override
    public Object aggregateArguments(ArgumentsAccessor accessor, ParameterContext context) throws ArgumentsAggregationException {
        int index = context.getIndex();
        Data data = new Data();
        data.setA(accessor.getInteger(index));
        data.setB(accessor.getInteger(index + 1));
        data.setResult(accessor.getInteger(index + 2));
        data.setMessage(accessor.getString(index + 3));
        return data;
    }
}
```
#### è‡ªå®šä¹‰æ³¨è§£ä¼˜åŒ–
- JUnit5æ”¯æŒè‡ªå®šä¹‰æ³¨è§£ï¼Œå†ç®€åŒ–ä¸€ä¸‹ï¼š
  - æ–°å»ºæ³¨è§£ç±» `YamlToSum.java`ï¼Œå°±æ˜¯æŠŠ`@AggregateWith(SumAggregator.class)`æ¬è¿‡æ¥äº†ï¼š
```java
//æŒ‡å®šæ³¨é‡Šè¦ä¿ç•™å¤šé•¿æ—¶é—´
@Retention(RetentionPolicy.RUNTIME)
//æ³¨è§£ä½ç½®ï¼šæ–¹æ³•çš„å½¢å¼å‚æ•°å£°æ˜
@Target(ElementType.PARAMETER)
//ä½œç”¨
@AggregateWith(SumAggregator.class)
public @interface YamlToSum {
}
```

```java
 //è‡ªå®šä¹‰æ³¨è§£ä¼˜åŒ–
@ParameterizedTest(name = "[{index}] {0} + {1} = {2}")
@MethodSource("sumArgData")
void sumArgOptimalTest(@YamlToSum Data data){
    System.out.println(data);
    MySUT mySUT = new MySUT("yaml Calculator");
    int result = mySUT.sum(data.getA(), data.getB());
    //hamcrestæ–­è¨€æ•°å­—è®¡ç®—
    assertThat(data.getMessage(),result, equalTo(data.getResult()));
}
```