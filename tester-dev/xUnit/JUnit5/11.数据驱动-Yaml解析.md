---
tags: note
status: todo
priority: 1
time: 2022-06-20 17:22
things:  "[ğŸ§Š](things:///show?id=JtkDsmtmq6Bd8ZbzKBJTW4)"
---
# Yamlæ–‡ä»¶è§£æ
## Listç»“æ„è§£æ
JacksonYamlTest
## List+Mapç»“æ„è§£æ
### Yamlæ–‡ä»¶
`order.yaml`

```yaml
- item: No. 9 Sprockets
  quantity: 12
  unitPrice: 1.23
  orderDate: 2019-04-17
  getFlag: true
- item:  No. Widget (10mm)
  quantity: 10
  unitPrice: 3.45
  orderDate: 2022-01-16
  getFlag: false
```

### ç›´æ¥å£°æ˜ç±»å‹è§£æ
- `List<HashMap<String, Object>>`


```java
//ç›´æ¥å£°æ˜ç±»å‹è§£æ
@DisplayName("ç›´æ¥å£°æ˜ç±»å‹")
@Test
public void listAndMapTest() throws IOException {
    ObjectMapper mapper = new ObjectMapper(new YAMLFactory());
    TypeReference<List<HashMap<String, Object>>> typeReference =
    new TypeReference<List<HashMap<String, Object>>>() {};
    List<HashMap<String, Object>> hashMaps = mapper.readValue(
    new File("src/test/resources/yaml/order.yaml"), typeReference);
    System.out.println(hashMaps);
}
```

```
[{unitPrice=1.23, item=No. 9 Sprockets, quantity=12, orderDate=2019-04-17, getFlag=true}, {unitPrice=3.45, item=No. Widget (10mm), quantity=10, orderDate=2022-01-16, getFlag=false}]
```
### å£°æ˜å®ä½“ç±»è§£æ
#### æˆå‘˜å˜é‡ä¸keyä¸€è‡´
```java
@Data
public class OrderData {
  private String item;
  private Integer quantity;
  private BigDecimal unitPrice;
  private LocalDate orderDate;
  private Boolean getFlag;
}
```


```java
/**
 * å®ä½“ç±»çš„æˆå‘˜å˜é‡ä¸yamlæ–‡ä»¶çš„keyä¸€è‡´
 * dataTimeæŠ¥é”™ï¼šæ·»åŠ jackson-datatype-jsr310
 * @throws IOException
 */
@DisplayName("å®ä½“ç±»è§£æ-æˆå‘˜å˜é‡ä¸keyä¸€è‡´")
@Test
public void orderSameTest() throws IOException {
      ObjectMapper mapper = new ObjectMapper(new YAMLFactory());
      //åŠŸèƒ½ä¸Šç­‰ä»·çš„ä¾¿æ·æ–¹æ³•ï¼š mapper.registerModules(mapper.findModules());
      //æˆ‘ä»¬éœ€è¦ä½¿ç”¨ findAndRegisterModulesæ–¹æ³•ï¼Œä»¥ä¾¿ Jacksonæ­£ç¡®å¤„ç†æˆ‘ä»¬çš„æ—¥æœŸ
      //Jacksonä¹Ÿå¯ä»¥è‡ªåŠ¨æœç´¢æ‰€æœ‰æ¨¡å—ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ³¨å†Œ
      mapper.findAndRegisterModules();
      TypeReference<List<Order>> typeReference = new TypeReference<List<Order>>() {
      };
      List<Order> orderLines = mapper.readValue(new File("src/test/resources/yaml/order.yaml"), typeReference);
      System.out.println(orderLines);
}
```
#### æˆå‘˜å˜é‡ä¸keyä¸ä¸€è‡´
- `@JsonProperty`
    - è¡¨æ˜å¯¹åº”å®ä½“ç±»çš„æˆå‘˜å˜é‡ ä¸`yaml`çš„`key`å¯¹åº”å…³ç³»
```java
@Data
public class OrderListData {
    @JsonProperty("item")
    private String otherItem;
    @JsonProperty("quantity")
    private int qua;
    @JsonProperty("unitPrice")
    private BigDecimal price;
    @JsonProperty("orderDate")
    private LocalDate date;
    @JsonProperty("getFlag")
    private Boolean isFlag;
}
```


```java
/**
 * å®ä½“ç±»çš„æˆå‘˜å˜é‡ä¸yamlæ–‡ä»¶keyä¸ä¸€è‡´
 * éœ€è¦åœ¨å®ä½“ç±»çš„æˆå‘˜å˜é‡ä¸Šå£°æ˜@JsonProperty("")
 * @throws IOException
 */
@DisplayName("å®ä½“ç±»è§£æ-æˆå‘˜å˜é‡ä¸keyä¸ä¸€è‡´")
@Test
public void orderListTest() throws IOException {
    ObjectMapper mapper = new ObjectMapper(new YAMLFactory());
    //åŠŸèƒ½ä¸Šç­‰ä»·çš„ä¾¿æ·æ–¹æ³•ï¼š mapper.registerModules(mapper.findModules());
    //æˆ‘ä»¬éœ€è¦ä½¿ç”¨ findAndRegisterModulesæ–¹æ³•ï¼Œä»¥ä¾¿ Jacksonæ­£ç¡®å¤„ç†æˆ‘ä»¬çš„æ—¥æœŸ
    //Jacksonä¹Ÿå¯ä»¥è‡ªåŠ¨æœç´¢æ‰€æœ‰æ¨¡å—ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ³¨å†Œ
    mapper.findAndRegisterModules();
    TypeReference<List<OrderList>> typeReference = new TypeReference<List<OrderList>>() {
    };
    List<OrderList> orderLists = mapper.readValue(new File("src/test/resources/yaml/order.yaml"), typeReference);
    System.out.println(orderLists);
}
```

## Map+List+Mapè§£æ
### Yamlæ–‡ä»¶
`orderlines.yaml`

```yaml
orderLines:
  - item: No. 9 Sprockets
    quantity: 12
    unitPrice: 1.23
    orderDate: 2019-04-17
    getFlag: true
  - item:  No. Widget (10mm)
    quantity: 10
    unitPrice: 3.45
    orderDate: 2022-01-16
    getFlag: false
```

### ç›´æ¥å£°æ˜ç±»å‹è§£æ
- `HashMap<String,List<HashMap<String, Object>>>`


```java
//ç›´æ¥å£°æ˜ç±»å‹è§£æ HashMap<String,List<HashMap<String, Object>>>
@DisplayName("ç›´æ¥å£°æ˜ç±»å‹")
@Test
void mapAndListAndMapTest() throws IOException {
    ObjectMapper mapper = new ObjectMapper(new YAMLFactory());
    TypeReference<HashMap<String, List<HashMap<String, Object>>>> typeReference =
        new TypeReference<HashMap<String,List<HashMap<String, Object>>>>() {};
    HashMap<String,List<HashMap<String, Object>>> hashMaps = mapper.readValue(
            new File("src/test/resources/yaml/orderlines.yaml"), typeReference);
    System.out.println(hashMaps);
}
```
### å£°æ˜å®ä½“ç±»è§£æ
#### æˆå‘˜å˜é‡ä¸keyä¸€è‡´
```java
@Data
public class OrderData {
  private String item;
  private Integer quantity;
  private BigDecimal unitPrice;
  private LocalDate orderDate;
  private Boolean getFlag;
}
```


```java
@Data
public class OrderLinesData {
  private List<OrderData> orderLines;
}
```


```java
    /**
 * å®ä½“ç±»çš„æˆå‘˜å˜é‡ä¸yamlæ–‡ä»¶çš„keyä¸€è‡´
 * @throws IOException
 */
@DisplayName("å®ä½“ç±»è§£æ-æˆå‘˜å˜é‡ä¸keyä¸€è‡´")
@Test
public void orderLinesDataTest() throws IOException {
    ObjectMapper mapper = new ObjectMapper(new YAMLFactory());
    //åŠŸèƒ½ä¸Šç­‰ä»·çš„ä¾¿æ·æ–¹æ³•ï¼š mapper.registerModules(mapper.findModules());
    //æˆ‘ä»¬éœ€è¦ä½¿ç”¨ findAndRegisterModulesæ–¹æ³•ï¼Œä»¥ä¾¿ Jacksonæ­£ç¡®å¤„ç†æˆ‘ä»¬çš„æ—¥æœŸ
    //Jacksonä¹Ÿå¯ä»¥è‡ªåŠ¨æœç´¢æ‰€æœ‰æ¨¡å—ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ³¨å†Œ
    mapper.findAndRegisterModules();
    TypeReference<OrderLinesData> typeReference = new TypeReference<OrderLinesData>() {
    };
    OrderLinesData orderLists = mapper.readValue(new File("src/test/resources/yaml/orderlines.yaml"), typeReference);
    System.out.println(orderLists);
}
```
#### æˆå‘˜å˜é‡ä¸keyä¸ä¸€è‡´
- `@JsonProperty`
    - è¡¨æ˜å¯¹åº”çš„æˆå‘˜å˜é‡ä¸`yaml`çš„`key`å¯¹åº”å…³ç³»
```java
@Data
public class OrderListData {
  @JsonProperty("item")
  private String otherItem;
  @JsonProperty("quantity")
  private int qua;
  @JsonProperty("unitPrice")
  private BigDecimal price;
  @JsonProperty("orderDate")
  private LocalDate date;
  @JsonProperty("getFlag")
  private Boolean isFlag;
}



```


```java
@Data
public class OrderLinesListData {
  @JsonProperty("orderLines")
  private List<OrderListData> lists;
}
```


```java
@Test
public void orderLinesListDataTest() throws IOException {
    ObjectMapper mapper = new ObjectMapper(new YAMLFactory());
    //åŠŸèƒ½ä¸Šç­‰ä»·çš„ä¾¿æ·æ–¹æ³•ï¼š mapper.registerModules(mapper.findModules());
    //æˆ‘ä»¬éœ€è¦ä½¿ç”¨ findAndRegisterModulesæ–¹æ³•ï¼Œä»¥ä¾¿ Jacksonæ­£ç¡®å¤„ç†æˆ‘ä»¬çš„æ—¥æœŸ
    //Jacksonä¹Ÿå¯ä»¥è‡ªåŠ¨æœç´¢æ‰€æœ‰æ¨¡å—ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ³¨å†Œ
    mapper.findAndRegisterModules();
    TypeReference<OrderLinesListData> typeReference = new TypeReference<OrderLinesListData>() {
    };
    OrderLinesListData orderLists = mapper.readValue(new File("src/test/resources/yaml/orderlines.yaml"), typeReference);
    System.out.println(orderLists);
}
```

## Maps+List+Mapè§£æ

### Yamlæ–‡ä»¶
`order.yaml`

```yaml
orderNo: A001
date: 2019-04-17
customerName: Customer, Joe
orderLines:
  - item: No. 9 Sprockets
    quantity: 12
    unitPrice: 1.23
  - item: No. Widget (10mm)
    quantity: 40
    unitPrice: 3.45
```


- æ— æ³•ç›´æ¥å£°æ˜ç±»å‹è§£æ
### å£°æ˜å®ä½“ç±»è§£æ
#### æˆå‘˜å˜é‡ä¸keyä¸€è‡´
```java
@Data
public class OrderLine{
    private String item;
    private int quantity;
    private BigDecimal unitPrice;
    private LocalDate orderDate;
}

```


```java


@Data
public class Order {
    private String orderNo;
    private LocalDate date;
    private String customerName;
    private List<OrderLine> orderLines;
}
```


```java
@Test
public void orderLinesTest() throws IOException {
    ObjectMapper mapper = new ObjectMapper(new YAMLFactory());
    //åŠŸèƒ½ä¸Šç­‰ä»·çš„ä¾¿æ·æ–¹æ³•ï¼š mapper.registerModules(mapper.findModules());
    //æˆ‘ä»¬éœ€è¦ä½¿ç”¨ findAndRegisterModulesæ–¹æ³•ï¼Œä»¥ä¾¿ Jacksonæ­£ç¡®å¤„ç†æˆ‘ä»¬çš„æ—¥æœŸ
    //Jacksonä¹Ÿå¯ä»¥è‡ªåŠ¨æœç´¢æ‰€æœ‰æ¨¡å—ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ³¨å†Œ
    mapper.findAndRegisterModules();
    TypeReference<Order> typeReference = new TypeReference<Order>() {
    };
    Order order = mapper.readValue(new File("src/test/resources/yaml/order.yaml"), typeReference);
    System.out.println(order);
}
```
#### æˆå‘˜å˜é‡ä¸keyä¸ä¸€è‡´
- @JsonProperty
    - è¡¨æ˜å¯¹åº”çš„æˆå‘˜å˜é‡ä¸yamlçš„keyå¯¹åº”å…³ç³»
```java
@Data
public class OrderList {
    @JsonProperty("item")
    private String otherItem;
    @JsonProperty("quantity")
    private int qua;
    @JsonProperty("unitPrice")
    private BigDecimal price;
    @JsonProperty("orderDate")
    private LocalDate date;
}

```


```java


@Data
public class OrderOther {
    @JsonProperty("orderNo")
    private String orderNum;
    @JsonProperty("date")
    private LocalDate Date;
    @JsonProperty("customerName")
    private String customername;
    @JsonProperty("orderLines")
    private List<OrderList> orderLists;
}
```


```java
@Test
public void orderOtherTest() throws IOException {
    ObjectMapper mapper = new ObjectMapper(new YAMLFactory());
    //åŠŸèƒ½ä¸Šç­‰ä»·çš„ä¾¿æ·æ–¹æ³•ï¼š mapper.registerModules(mapper.findModules());
    //æˆ‘ä»¬éœ€è¦ä½¿ç”¨ findAndRegisterModulesæ–¹æ³•ï¼Œä»¥ä¾¿ Jacksonæ­£ç¡®å¤„ç†æˆ‘ä»¬çš„æ—¥æœŸ
    //Jacksonä¹Ÿå¯ä»¥è‡ªåŠ¨æœç´¢æ‰€æœ‰æ¨¡å—ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ³¨å†Œ
    mapper.findAndRegisterModules();
    TypeReference<OrderOther> typeReference = new TypeReference<OrderOther>() {
    };
    OrderOther orderOther = mapper.readValue(new File("src/test/resources/yaml/order.yaml"), typeReference);
    System.out.println(orderOther);
    orderOther.getOrderLists().forEach(orderList -> {
        assertAll(
                () -> assertThat(orderList.getOtherItem(), startsWith("No")),
                () -> assertThat(orderList.getQua(), is(greaterThan(9))),
                () -> assertThat(orderList.getPrice(), is(closeTo(new BigDecimal(1.0),new BigDecimal(4.00))))
        );
    });
}
```