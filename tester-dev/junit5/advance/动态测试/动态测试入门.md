---
tags: note
status: doing
priority: 1
time: 2022-06-08 10:27
things:  "[ğŸ§Š](things:///show?id=JtkDsmtmq6Bd8ZbzKBJTW4)"
---


`JUnit Dynamic Tests`
## æ¦‚å¿µ

åŠ¨æ€æµ‹è¯•æ˜¯ `JUnit 5` ä¸­å¼•å…¥çš„ä¸€ç§æ–°çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå…·ä½“çš„æ˜¯`JUnit Jupiter`å¼•å…¥çš„ä¸€ç§å…¨æ–°çš„æµ‹è¯•ç¼–ç¨‹æ¨¡å‹ã€‚è¿™ç§æ–°çš„æµ‹è¯•å°±æ˜¯`åŠ¨æ€æµ‹è¯•`ï¼Œå®ƒæ˜¯ç”±`@TestFactory`æ³¨è§£çš„å·¥å‚æ–¹æ³•åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ã€‚

æœ¬æ¬¡æ–‡ç« ï¼Œå°†äº†è§£åŠ¨æ€æµ‹è¯•åˆ°åº•æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•åˆ›å»ºã€‚

æˆ‘ä»¬å·²ç»çŸ¥é“åœ¨æµ‹è¯•ç”¨ä¾‹ç›¸å…³çš„æ–¹æ³•ä¸Šç›´æ¥æ·»åŠ `@Test`æ³¨è§£å°±å¯ä»¥è¿è¡Œè¯¥æ–¹æ³•ã€‚

- é‚£åŠ¨æ€æµ‹è¯•å’Œå®ƒåˆæœ‰ä»€ä¹ˆä¸åŒç‚¹å‘¢ï¼Ÿ
- ä¸ºä»€ä¹ˆä¼šæœ‰åŠ¨æ€æµ‹è¯•å‘¢ï¼Ÿ
- ç›´æ¥ç”¨`Test`æ³¨è§£ä¸å°±å¯ä»¥äº†å—ï¼Ÿ

ä¸‹é¢æˆ‘ä»¬å¸¦ç€è¿™äº›ç–‘é—®ğŸ¤”ï¸å»å­¦ä¹ åŠ¨æ€æµ‹è¯•ã€‚

## ä»€ä¹ˆæ˜¯åŠ¨æ€æµ‹è¯•

- ==åŠ¨æ€æµ‹è¯•==ï¼šå°±æ˜¯`DynamicTest`åœ¨==è¿è¡Œçš„æ—¶å€™åŠ¨æ€çš„ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹==ã€‚
	- ç”±`@TestFactory`æ³¨è§£å£°æ˜çš„æ–¹æ³•ã€‚


-  ==é™æ€æµ‹è¯•==ï¼š`@Test`æ³¨è§£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå› ä¸ºè¯¥ç”¨ä¾‹åœ¨==ç¼–è¯‘==æ—¶å·²ç»å®Œå…¨æŒ‡å®šå¥½çš„ã€‚


## åŠ¨æ€æµ‹è¯•ä¸é™æ€æµ‹è¯•åŒºåˆ«
- ä¸`@Test`æ–¹æ³•ç›¸æ¯”ï¼Œ`@TestFactory`æ–¹æ³•æœ¬èº«==ä¸æ˜¯æµ‹è¯•ç”¨ä¾‹==ï¼Œè€Œ**æ˜¯æµ‹è¯•ç”¨ä¾‹çš„å·¥å‚**ã€‚
	- æ‰€ä»¥å¾—åˆ°ç»“è®ºï¼š==åŠ¨æ€æµ‹è¯•æ˜¯å·¥å‚çš„äº§ç‰©==ã€‚


- åŠ¨æ€æµ‹è¯•`DynamicTest`ä¸æ ‡å‡† `@Test` ç”¨ä¾‹å®Œå…¨ä¸åŒ
>DynamicTestçš„æ‰§è¡Œæ–¹å¼ä¸æ ‡å‡†çš„`@Test`ä¸åŒ

- æ‰§è¡Œæ–¹å¼ä¸åŒ
	- ==åŠ¨æ€æµ‹è¯•ã€ŒDynamicTestã€ä¸æ”¯æŒç”Ÿå‘½å‘¨æœŸå›è°ƒ==ã€‚
	- å³ï¼šåŠ¨æ€æµ‹è¯•ã€Œ`DynamicTest`ã€ä¸ä¼šæ‰§è¡Œ `@BeforAll` ã€`@BeforeEach` `@AfterEach` ã€`@AfterAll` æ–¹æ³•çš„å›è°ƒã€‚


> åŠ¨æ€æµ‹è¯•çš„æ‰§è¡Œç”Ÿå‘½å‘¨æœŸä¸æ ‡å‡†çš„`@Test`æƒ…å†µå®Œå…¨ä¸åŒã€‚å…·ä½“è€Œè¨€ï¼Œä¸ªåˆ«åŠ¨æ€æµ‹è¯•æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸå›è°ƒã€‚è¿™æ„å‘³ç€`@BeforeEach`å’Œ`@AfterEach`æ–¹æ³•åŠå…¶ç›¸åº”çš„æ‰©å±•å›è°ƒå‡½æ•°æ˜¯ä¸º`@TestFactory`æ–¹æ³•æ‰§è¡Œï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªåŠ¨æ€æµ‹è¯•æ‰§è¡Œã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæ‚¨ä»ä¸€ä¸ªlambdaè¡¨è¾¾å¼çš„æµ‹è¯•å®ä¾‹ä¸­è®¿é—®åŠ¨æ€æµ‹è¯•çš„å­—æ®µï¼Œè¿™äº›å­—æ®µå°†ä¸ä¼šç”±åŒä¸€ä¸ª`@TestFactory`æ–¹æ³•ç”Ÿæˆçš„å„ä¸ªåŠ¨æ€æµ‹è¯•ä¹‹é—´çš„å›è°ƒæ–¹æ³•æˆ–æ‰©å±•é‡ç½®ã€‚
	
	


## åŠ¨æ€æµ‹è¯•çš„æ„æˆ

1. æ–¹æ³•ä¸Šå¿…é¡»æœ‰ `@TestFactory` æ³¨è§£ã€‚
	- å› ä¸ºåŠ¨æ€æµ‹è¯•æœ¬è´¨æ˜¯`@TestFactory` å·¥å‚æ–¹æ³•ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ã€‚
	- ä¸`@Test`æ–¹æ³•ä¸€æ ·ï¼Œ`@TestFactory`æ–¹æ³•ä¸èƒ½æ˜¯`private`æˆ–`static`ã€‚
	- å¯ä»¥é€‰æ‹©å£°æ˜å‚æ•°ï¼Œé€šè¿‡`ParameterResolvers`è§£æã€‚


2. ç”±==æ˜¾ç¤ºåç§°==å’Œ==Executable==ç»„æˆã€‚
	- æ˜¾ç¤ºåç§°ï¼š`displayName`
	- `Executable`æ˜¯`@FunctionalInterface`
		- åŠ¨æ€æµ‹è¯•çš„å®ç°å¯ä»¥é€šè¿‡_lambdaè¡¨è¾¾å¼_æˆ–_æ–¹æ³•å¼•ç”¨_æ¥å®ç°ã€‚


3. æ–¹æ³•è¿”å›å€¼ç±»å‹ã€‚ã€Œæµã€é›†åˆã€è¿­ä»£å™¨ã€
	- `Stream`
	- `Collection`
	- `Iterable`
	- `Iterator` 
	-  `DynamicNode` 

>å¦‚æœä¸è¿”å›ä»¥ä¸Šç±»å‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

- è¿”å›å…¶å®ƒç±»å‹æŠ¥é”™ï¼š`JUnitException`
	- å› ä¸º==ç¼–è¯‘==æ—¶æ— æ³•æ£€æµ‹åˆ°æœ‰æ•ˆçš„è¿”å›ç±»å‹

ä»æŠ€æœ¯ä¸Šè®²ï¼Œ`@TestFactory`æ–¹æ³•å¿…é¡»è¿”å›`DynamicNode`å®ä¾‹çš„`Stream`ï¼Œ`Collection`ï¼Œ`Iterable`æˆ–`Iterator`ã€‚ 
- `DynamicNode`çš„å¯å®ä¾‹åŒ–çš„å­ç±»æ˜¯`DynamicContainer`å’Œ`DynamicTest`ã€‚
	- `DynamicContainer`å®ä¾‹ç”±ä¸€ä¸ª**æ˜¾ç¤ºåç§°**å’Œä¸€ä¸ª**åŠ¨æ€å­èŠ‚ç‚¹åˆ—è¡¨**ç»„æˆï¼Œå¯ä»¥åˆ›å»ºä»»æ„åµŒå¥—çš„åŠ¨æ€èŠ‚ç‚¹å±‚æ¬¡ç»“æ„ã€‚
	- `DynamicTest`å®ä¾‹å°†è¢«å»¶è¿Ÿæ‰§è¡Œï¼Œä»è€Œå®ç°æµ‹è¯•ç”¨ä¾‹ä¾æ®éç¡®å®šæ€§çš„åŠ¨æ€ç”Ÿæˆã€‚

>  DynamicContainer æ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„å®¹å™¨ã€‚ å®ƒç”±ä¸€ä¸ªæ˜¾ç¤ºåç§°å’Œä¸€ä¸ª Iterable æˆ– DynamicNode æµç»„æˆã€‚ DynamicContainer çš„å®ä¾‹å¿…é¡»ç”±å¸¦æœ‰@TestFactory æ³¨è§£çš„å·¥å‚æ–¹æ³•ç”Ÿæˆã€‚

- æ§åˆ¶**æµ‹è¯•æ–¹æ³•çš„æ‰§è¡Œé¡ºåº**ï¼š
	- ç”¨ `@TestMethodOrder` æ³¨é‡Šæ‚¨çš„==æµ‹è¯•ç±»==æˆ–==æµ‹è¯•æ¥å£==
	- æŒ‡å®šæ‰€éœ€çš„ `MethodOrderer` å®ç°


## åˆ›å»º
### é™æ€æµ‹è¯•ç”¨ä¾‹åˆ›å»º
```java
public class DynamicBaseTest {

	// Static test 1
	@Test
	void test_Add() {
		assertEquals(5, 3+2);
	}
    
	// Static test 2
	@Test
	void test_Devide() {
		assertEquals(5,25/5);
	}
}

```
### åŠ¨æ€æµ‹è¯•ç”¨ä¾‹åˆ›å»º
#### æ”¹ç¼–é™æ€æµ‹è¯•ç”¨ä¾‹
- ç”±ä»¥ä¸Šå¸¦å‚æ•°çš„é™æ€æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹ä¸ºåŠ¨æ€æµ‹è¯•ç”¨ä¾‹
```java
public class DynamicBaseTest {
	// This method produces Dynamic test cases
	@TestFactory
	Collection<DynamicTest> dynamicTestsFromCollection() {

		return Arrays.asList(
				dynamicTest("1stDynamic", () -> assertEquals(5, 3+2)),
				dynamicTest("2ndDynamic", () -> assertEquals(5, 25/5))
		);
	}
}
```
![](https://cdn.jsdelivr.net/gh/testeru-top/images/tester/202206081619552.png)


##### ç»“è®º
åŠ¨æ€æµ‹è¯•æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡å·¥å‚æ–¹æ³•ä½¿ç”¨@TestFactory æ³¨è§£ç”Ÿæˆçš„æµ‹è¯•ã€‚
æ ‡è®°ä¸º@TestFactory çš„æ–¹æ³•ä¸æ˜¯æµ‹è¯•ç”¨ä¾‹ï¼Œè€Œæ˜¯æµ‹è¯•ç”¨ä¾‹çš„å·¥å‚ã€‚

### åˆ›å»ºåŠ¨æ€æµ‹è¯•çš„è§„åˆ™

1. `@TestFactory`æ–¹æ³•ä¸èƒ½æ˜¯ `privateor` ,`static`ã€‚
2. `@TestFactory`æ–¹æ³•è¿”å›ç±»å‹å¿…é¡»ä¸ºï¼š `Streamã€Collectionã€Iterableã€æˆ–Iterator`ã€‚
3. `@TestFactory`æ–¹æ³•è¿”å›å®ä¾‹å¿…é¡»ä¸ºï¼š`DynamicNode`ã€`DynamicContainer` å’Œ`DynamicTest`ã€‚
>DynamicNodeæ˜¯DynamicContainerå’ŒDynamicTestçš„çˆ¶ç±»
#### è¿”å›å®ä¾‹
```java
package top.testeru.dynamic.test;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.DynamicContainer;
import org.junit.jupiter.api.DynamicTest;
import org.junit.jupiter.api.TestFactory;
import java.util.stream.Stream;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

public class DynamicNodeTest {
    //æ–¹æ³•è¿”å›å®ä¾‹ä¸ºDynamicTest
    @TestFactory
    @DisplayName("å•ä¸ª")
    DynamicTest dynamicTest() {
        return DynamicTest.dynamicTest("å•ä¸ªåŠ¨æ€æµ‹è¯•",
                () -> assertEquals(5, 3+2));
    }
    //æ–¹æ³•è¿”å›å®ä¾‹ä¸ºDynamicContainer
    @TestFactory
    @DisplayName("å®¹å™¨")
    DynamicContainer dynamicTestsFromStream() {
        return DynamicContainer.dynamicContainer("å¤šä¸ªåŠ¨æ€æµ‹è¯•",

                Stream.of(
                        DynamicTest.dynamicTest("1ã€åŠ¨æ€å®¹å™¨",
                                () -> assertEquals(5, 3+2)),
                        DynamicTest.dynamicTest("2ã€åŠ¨æ€å®¹å™¨",
                                () -> assertEquals(5,25/5))
                        ));
    }
}
```
![](https://cdn.jsdelivr.net/gh/testeru-top/images/tester/202206081659135.png)
#### è¿”å›ç±»å‹
##### Stream
```java
package top.testeru.dynamic.test;

import org.junit.jupiter.api.*;
import java.util.stream.Stream;
import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.Matchers.greaterThan;
import static org.hamcrest.core.Is.is;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;
import static org.junit.jupiter.api.DynamicTest.dynamicTest;

public class DynamicNodeTest {
    //åŠ¨æ€æµ‹è¯•ç”¨ä¾‹
    @TestFactory
    @DisplayName("streamåŠ¨æ€æµ‹è¯•")
    Stream<DynamicTest> dynamicTestsFromCollection() {

        return Stream.of(6, 8, 10)
                    .map(arg -> DynamicTest.dynamicTest("Dy test " + arg, () -> {
                                    System.out.println(arg);//14 22 32
                                    assertThat(arg, is(greaterThan(2)));
                                }));
    }
}
```
![](https://cdn.jsdelivr.net/gh/testeru-top/images/tester/202206081658196.png)




```java
public class DynamicNodeTest {
    @TestFactory
    @DisplayName("streamåŠ¨æ€æµ‹è¯•å¤šä¸ªæ–¹æ³•")
    Stream<DynamicContainer> dynamicTestsFromStream() {
        return Stream.of(6, 8, 10)
                .map(arg -> DynamicContainer.dynamicContainer("Container "+arg,
                        Stream.of(DynamicTest.dynamicTest("1.Dy test " + arg, () -> {
                                        System.out.println(arg);//14 22 32
                                        assertThat(arg, is(greaterThan(2)));
                                    }),
                                DynamicTest.dynamicTest("2.Dy test " + arg, () -> {
                                    System.out.println(arg+1);//14 22 32
                                    assertThat(arg+1, is(greaterThan(4)));
                                })
                        )));
    }
}
```
![](https://cdn.jsdelivr.net/gh/testeru-top/images/tester/202206081814825.png)

##### Collection
```java
public class DynamicNodeTest {
	//ä¸èƒ½ static private ä¿®é¥°
    //è¿”å›å€¼ç±»å‹ï¼šStream Collection Iterable Iterator DynamicNode
    @TestFactory
    Collection<DynamicTest> dynamicWithCollection(){
        Collection<DynamicTest> dynamicTestCollection = new ArrayList<>();
        DynamicTest dynamicTest1 = DynamicTest.dynamicTest("1.dynamic add test",
                () -> System.out.println("åªæ˜¯æ‰“å°åŠ æ³•"));
        DynamicTest dynamicTest2 = DynamicTest.dynamicTest("2.dynamic sub test",
                ()-> System.out.println("åªæ˜¯æ‰“å°å‡æ³•"));
        dynamicTestCollection.add(dynamicTest1);
        dynamicTestCollection.add(dynamicTest2);
        return dynamicTestCollection;
    }
}
```
![](https://cdn.jsdelivr.net/gh/testeru-top/images/tester/202206081847147.png)

##### è¿­ä»£å™¨
- `Iterator`
	- å…·æœ‰è¿­ä»£çŠ¶æ€çš„å¯¹è±¡
	- æœ‰ `hasNext()`/`next()`
- `Iterable`
	- æ˜¯ä¸€ç³»åˆ—å¯ä»¥è¿­ä»£çš„å…ƒç´ 
> Javaä¸­é›†åˆä½¿ç”¨.iterator() è¿”å›å¯è¿­ä»£çš„å¯¹è±¡
```java
public class DynamicNodeTest {
    @TestFactory
    Iterator<DynamicTest> dynamicWithIterator(){

        Collection<DynamicTest> dynamicTestIterator = new ArrayList<>();
        PrimitiveIterator.OfInt iterator = IntStream.iterate(2, n -> n + 1).limit(10).iterator();

        while (iterator.hasNext()){
            Integer next = iterator.next();
            dynamicTestIterator.add(
                    DynamicTest.dynamicTest("åŠ æ³•æµ‹è¯•",  () -> {
                        System.out.println("n:" + next);
                        assertThat(next,is(greaterThan( 3)));
                    }));
        }
        return dynamicTestIterator.iterator();
    }

    @TestFactory
    Iterable<DynamicTest> dynamicWithIterable(){
        Collection<DynamicTest> dynamicTestIterator = new ArrayList<>();
        PrimitiveIterator.OfInt iterator = IntStream.iterate(2, n -> n + 1).limit(10).iterator();

        while (iterator.hasNext()){
            Integer next = iterator.next();
            dynamicTestIterator.add(
                    DynamicTest.dynamicTest("åŠ æ³•æµ‹è¯•",  () -> {
                        System.out.println("n:" + next);
                        assertThat(next,is(greaterThan( 3)));
                    }));
        }
        return dynamicTestIterator;
    }
}
```
![](https://cdn.jsdelivr.net/gh/testeru-top/images/tester/202206081859805.png)

### åŠ¨æ€æµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
åœ¨åŠ¨æ€æµ‹è¯•ä¸­ï¼Œ`@BeforeEach` å’Œ `@AfterEach` ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¼šé’ˆå¯¹æ¯ä¸ª `@TestFactory` æ–¹æ³•æ‰§è¡Œï¼Œä½†ä¸ä¼šé’ˆå¯¹æ¯ä¸ªåŠ¨æ€æµ‹è¯•æ‰§è¡Œã€‚

##### é™æ€æµ‹è¯•ç”¨ä¾‹
```java
public class DynamicParamsTest {
	static int m = 0;

	@BeforeAll
	static void beforeAll() {
		System.out.println("BeforeAll");
	}

	@BeforeEach
	void beforeEach() {
		System.out.println("BeforeEach:" + m);//0 9 9
		m = 8;
	}

	@AfterEach
	void afterEach() {
		m = 9;
	}

	@AfterAll
	static void afterAll() {
		System.out.println("AfterAll");
	}


	@ParameterizedTest
	@MethodSource("argstream")
	void staticTest(int arg) {
		System.out.println("m:" + m);//8  8  8
		m += arg;
		System.out.println(m);//14 16 18
		assertThat(arg, is(greaterThan(2)));
	}

	static Stream argstream() {
		return Stream.of(6, 8, 10);
	}
}
```
#### é™æ€æµ‹è¯•ç”¨ä¾‹
```java
public class DynamicParamsTest {
	static int m = 0;

	@BeforeAll
	static void beforeAll() {
		System.out.println("BeforeAll");
	}

	@BeforeEach
	void beforeEach() {
		System.out.println("BeforeEach:" + m);//0 9 9
		m = 8;
	}

	@AfterEach
	void afterEach() {
		m = 9;
	}

	@AfterAll
	static void afterAll() {
		System.out.println("AfterAll");
	}
    

	/**
	 * åªæ‰“å°ä¸€æ¬¡beforeeach mä¸º8
	 * åŠ¨æ€ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
	 * @return
	 */
	@TestFactory
	Stream<DynamicTest> dyTestFactory(){

		return Stream.of(6, 8, 10)
				.map(arg -> dynamicTest("test" + arg, () -> {
					System.out.println("m:"+m);//8  14  22
					m +=arg;
					System.out.println(m);//14 22 32
					assertThat(arg, is(greaterThan(2)));
				}));

	}
}
```


è¿è¡Œå¾—å‡ºç»“è®ºï¼š
- `static Test`çš„æ¯ä¸€ä¸ªå‚æ•°ç”¨ä¾‹éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡`BeforeEach`å’Œ`AfterEach`
- `Dynamic Test`çš„æ–¹æ³•åªä¼šæ‰§è¡Œä¸€æ¬¡`BeforeEach`å’Œ`AfterEach`
  - é»˜è®¤æŠŠ`BeforeEach`å’Œ`AfterEach`çš„ç”Ÿå‘½å‘¨æœŸæå‡ä¸ºäº†`BeforeAll`ã€`AfterAll`


>æ ¹æ®ä»¥ä¸Šç”¨ä¾‹å¾—å‡ºç»“è®ºï¼šåœ¨åŠ¨æ€æµ‹è¯•ä¸­ï¼Œ`@BeforeEach` å’Œ `@AfterEach` ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¼šé’ˆå¯¹æ¯ä¸ª `@TestFactory` æ–¹æ³•æ‰§è¡Œï¼Œä½†ä¸ä¼šé’ˆå¯¹æ¯ä¸ªåŠ¨æ€æµ‹è¯•æ‰§è¡Œã€‚





## åŠ¨æ€æµ‹è¯•ä¸­çš„æ‰§è¡Œé¡ºåº

- åŠ¨æ€æµ‹è¯•çš„æ–¹æ³•é¡ºåºä¸ä¾èµ–äºåœ¨é¡¶çº§æµ‹è¯•ç±»ä¸Šå£°æ˜çš„@TestMethodOrderã€‚
- ä¸ºäº†æ§åˆ¶åŠ¨æ€æµ‹è¯•çš„é¡ºåºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ’åºã€‚


>è‡ªå®šä¹‰æ¯”è¾ƒæ–¹å¼ï¼ŒæŒ‰æ˜¾ç¤ºåç§°çš„é™åºæ§åˆ¶æ‰§è¡Œé¡ºåº
```java
package top.testeru.dynamic.test;

import org.junit.jupiter.api.DynamicTest;
import org.junit.jupiter.api.TestFactory;
import java.util.Arrays;
import java.util.Collection;
import java.util.List;
import static org.junit.jupiter.api.DynamicTest.dynamicTest;
public class DynamicOrderTest {
	@TestFactory
	@DisplayName("è‡ªå®šä¹‰åŠ¨æ€æµ‹è¯•æ’åº")
	Collection<DynamicTest> testDynamicTestsOrder() {

		List<DynamicTest> dynamicTests = Arrays.asList(
				dynamicTest("1st dynamic test", () -> {
					System.out.println("=> 1st dynamic test");
				}),
				dynamicTest("2nd dynamic test", () -> {
					System.out.println("=> 2nd dynamic test");
				}),
				dynamicTest("3rd dynamic test", () -> {
					System.out.println("=> 3rd dynamic test");
				})
		);

		sortDynamicTests(dynamicTests);
		return dynamicTests;
	}

	static void sortDynamicTests(List<DynamicTest> dynamicTests) {
		dynamicTests.sort((DynamicTest d1, DynamicTest d2) ->
				d2.getDisplayName().compareTo(d1.getDisplayName()));
	}
}
```

## åŠ¨æ€æµ‹è¯•å‚æ•°åŒ–
- åœ¨å‰é¢è¿”å›å€¼ç±»å‹ä¸ºstreamçš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨çš„å‚æ•°åŒ–
>æœ¬æ¬¡ä½¿ç”¨Collectionæ¼”ç¤º

- æœ‰å¤šä¸ªIPå‚æ•°ï¼Œä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹
  - ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ‰“å°ï¼š1ã€é›†åˆå‚æ•°åŒ–ï¼šipåœ°å€
  - ç¬¬äºŒä¸ªæµ‹è¯•ç”¨ä¾‹æ‰“å°ï¼š2ã€ipå‚æ•°åŒ–ï¼š--ipåœ°å€

```java
public class DynamicParamsTest {
	@TestFactory
	Collection<DynamicTest> dynamicTestsFromStreamInJava8() {
		Collection<DynamicTest> dynamicTests = new ArrayList<>();
		Arrays.asList("154.174.10.56", "211.152.104.132", "178.144.120.156")
				.forEach(s -> {
					//æ¯ä¸€ä¸ªå‚æ•°è¿›è¡ŒåŠ¨æ€æµ‹è¯•ç”¨ä¾‹
					DynamicTest dynamicTest = DynamicTest.dynamicTest("1ã€é›†åˆå‚æ•°åŒ–", () -> {
						System.out.println("1ã€é›†åˆå‚æ•°åŒ–ï¼š" + s);
					});

					DynamicTest dynamicTest1 = DynamicTest.dynamicTest("2ã€é›†åˆå‚æ•°åŒ–", () -> {
						System.out.println("2ã€ipå‚æ•°åŒ–ï¼š--" + s);
					});
					dynamicTests.add(dynamicTest);
					dynamicTests.add(dynamicTest1);
				});

		return dynamicTests;
	}
}
```

- ä¼˜åŒ–ï¼šå¯ä»¥ç›´æ¥å¥—ç”¨åœ¨ä¸€èµ·ï¼Œå¦‚ä¸‹ï¼š

```java
public class DynamicParamsTest {
    @TestFactory
    Collection<DynamicTest> dyTestCollection(){
        List<DynamicTest> dynamicTests = new ArrayList<DynamicTest>();
        Arrays.asList(6, 8, 10)
                .forEach(arg ->{

                            dynamicTests.add(
                                    dynamicTest("test" + arg,
                                            () -> {
                                                System.out.println("m:"+m);//8  14  22
                                                m +=arg;
                                                System.out.println("m+arg:"+m);//8  14  22
                                                assertThat(arg, is(greaterThan(2)));
                                            }
                                    ));
                            dynamicTests.add(
                                    dynamicTest("test-" + arg,
                                            () ->{
                                                System.out.println("m-:"+m);//8  14  22
                                                m -=arg;
                                                System.out.println("m-arg:"+m);//8  14  22
                                                assertThat(arg, is(greaterThan(2)));
                                            }
                                    ));
                            });

        return dynamicTests;
    }
}
```


![](https://cdn.jsdelivr.net/gh/testeru-top/images/tester/202206081952622.png)
## åŠ¨æ€æµ‹è¯•å¹¶å‘
- è¦åœ¨ Junit ä¸­å¯ç”¨å¹¶è¡Œæµ‹è¯•ï¼Œåœ¨`src/test/resources`ä¸‹åˆ›å»º`junit-platform.properties`ï¼š
```properties
junit.jupiter.execution.parallel.enabled=true
junit.jupiter.execution.parallel.config.strategy=dynamic
```
### æŒ‡å®šåŠ¨æ€æµ‹è¯•æ–¹æ³•æ‰§è¡Œå¹¶å‘

```java
public class DynamicParallelTest {
	//åŠ¨æ€æµ‹è¯•æ–¹æ³•æŒ‡å®šå¤šçº¿ç¨‹æ‰§è¡Œ
	@Execution(ExecutionMode.CONCURRENT)
	@TestFactory
	Collection<DynamicTest> parallelTest() {
		return Arrays.asList(
				dynamicTest("1st dynamic test", () -> {
					System.out.println(Thread.currentThread().getName()+" => 1st dynamic test");
				}),
				dynamicTest("2nd dynamic test", () -> {
					System.out.println(Thread.currentThread().getName()+" => 2nd dynamic test");
				}),
				dynamicTest("3rd dynamic test", () -> {
					System.out.println(Thread.currentThread().getName()+" => 3rd dynamic test");
				})
		);
	}
}

```
### æŒ‡å®šåŠ¨æ€æµ‹è¯•ç±»æ‰§è¡Œå¹¶å‘

```java
package top.testeru.dynamic.test;

import org.junit.jupiter.api.DynamicTest;
import org.junit.jupiter.api.TestFactory;
import org.junit.jupiter.api.parallel.Execution;
import org.junit.jupiter.api.parallel.ExecutionMode;

import java.util.Arrays;
import java.util.Collection;

import static org.junit.jupiter.api.DynamicTest.dynamicTest;

/**
 * @Classname: DynamicParallelTest
 * @Description: åŠ¨æ€æµ‹è¯•çš„å¹¶å‘æµ‹è¯•
 * @Date: 2022/6/8 21:44
 * @Created by top.testeru
 */
@Execution(ExecutionMode.CONCURRENT)
public class DynamicParallelClassTest {
    //åŠ¨æ€æµ‹è¯•æ–¹æ³•æŒ‡å®šå¤šçº¿ç¨‹æ‰§è¡Œ
//    @Execution(ExecutionMode.CONCURRENT)
    @TestFactory
    Collection<DynamicTest> parallelTest() {
        return Arrays.asList(
                dynamicTest("1st dynamic test", () -> {
                    System.out.println(Thread.currentThread().getName()+" => 1st dynamic test");
                }),
                dynamicTest("2nd dynamic test", () -> {
                    System.out.println(Thread.currentThread().getName()+" => 2nd dynamic test");
                }),
                dynamicTest("3rd dynamic test", () -> {
                    System.out.println(Thread.currentThread().getName()+" => 3rd dynamic test");
                })
        );
    }
    //åŠ¨æ€æµ‹è¯•æ–¹æ³•æŒ‡å®šä¸»çº¿ç¨‹æ‰§è¡Œ
    @Execution(ExecutionMode.SAME_THREAD)
    @TestFactory
    Collection<DynamicTest> mainTest() {
        return Arrays.asList(
                dynamicTest("1st", () -> {
                    System.out.println(Thread.currentThread().getName()+" => 1st");
                }),
                dynamicTest("2nd", () -> {
                    System.out.println(Thread.currentThread().getName()+" => 2nd");
                }),
                dynamicTest("3rd", () -> {
                    System.out.println(Thread.currentThread().getName()+" => 3rd");
                })
        );
    }

}
```


![](https://cdn.jsdelivr.net/gh/testeru-top/images/tester/202206082152485.png)


## æ–¹æ³•
|æ–¹æ³•å|è¯´æ˜|
|---|---|
|`dynamicTest(String displayName,  Executable executable)`|ä¸ºå·¥å‚æä¾›æ˜¾ç¤ºåç§°ã€æ‰§è¡Œä»£ç å—åˆ›å»ºæ–°çš„åŠ¨æ€æµ‹è¯•å·¥å‚|



#### dynamicTest()
- `dynamicTest(String displayName, Executable executable)`
	- `displayName`
		- æµ‹è¯•ç”¨ä¾‹çš„åç§°
	- `executable`
		- æµ‹è¯•ä»£ç å—
		- ä¸å¯ä¸ºç©º

- `dynamicTest(String displayName, URI testSourceUri, Executable executable)`
	- `testSourceUri`
		- åŠ¨æ€æµ‹è¯•çš„è‡ªå®šä¹‰æµ‹è¯•æº URIï¼›
		- å¦‚æœæ¡†æ¶åº”è¯¥åŸºäº @TestFactory æ–¹æ³•ç”Ÿæˆæµ‹è¯•æºï¼Œåˆ™å¯èƒ½ä¸º null






## 4.å±‚æ¬¡æˆ–åµŒå¥—åŠ¨æ€æµ‹è¯•ç¤ºä¾‹



DynamicTestç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæµ‹è¯•åç§°æˆ–æ˜¾ç¤ºåç§°ï¼Œä»¥åŠä¸€ä¸ªExecutable



@TestFactoryæ–¹æ³•å‘Šè¯‰JUnitè¿™æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºåŠ¨æ€æµ‹è¯•çš„å·¥å‚ã€‚ å¦‚æˆ‘ä»¬æ‰€è§ï¼Œæˆ‘ä»¬ä»…è¿”å›DynamicTestçš„é›†åˆã€‚ æ¯ä¸ªDynamicTestéƒ½ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå³æµ‹è¯•åç§°æˆ–æ˜¾ç¤ºåç§°ä»¥åŠä¸€ä¸ªExecutableã€‚


@TestFactoryè¿”å›Streamï¼Œåˆ™åœ¨æ‰§è¡Œæ‰€æœ‰æµ‹è¯•åå®ƒå°†è‡ªåŠ¨å…³é—­ã€‚


https://www.youtube.com/watch?v=NElF6tsLxRE&list=PLq5LPoVktQ4IG1iUPoo234tvE8yN9xIG6&index=32



DynamicTest æ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ã€‚
å®ƒç”±æ˜¾ç¤ºåç§°å’Œå¯æ‰§è¡Œæ–‡ä»¶ç»„æˆã€‚
DynamicTest çš„å®ä¾‹å¿…é¡»ç”±å¸¦æœ‰@TestFactory æ³¨è§£çš„å·¥å‚æ–¹æ³•ç”Ÿæˆã€‚
è¯·æ³¨æ„ï¼ŒåŠ¨æ€æµ‹è¯•ä¸æ ‡å‡† @Test ç”¨ä¾‹å®Œå…¨ä¸åŒï¼Œå› ä¸ºåŠ¨æ€æµ‹è¯•ä¸ä¼šæ‰§è¡Œè¯¸å¦‚ @BeforeEach å’Œ @AfterEach æ–¹æ³•ä¹‹ç±»çš„å›è°ƒã€‚





-  DynamicNode æ”¯æŒçš„å­ç±»åŒ…æ‹¬ DynamicContainer å’Œ DynamicTestã€‚åŠ¨æ€æµ‹è¯•å°†å»¶è¿Ÿæ‰§è¡Œï¼Œæ”¯æŒåŠ¨æ€ç”šè‡³éç¡®å®šæ€§çš„æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆã€‚
@TestFactory è¿”å›çš„ä»»ä½• Stream éƒ½å°†é€šè¿‡è°ƒç”¨ stream.close() æ­£ç¡®å…³é—­ï¼Œä»è€Œå¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ Files.lines() ç­‰èµ„æºä½œä¸ºæµçš„åˆå§‹æºã€‚
@TestFactory æ–¹æ³•å¯ä»¥é€‰æ‹©å£°æ˜è¦ç”± ParameterResolvers è§£æçš„å‚æ•°ã€‚
æµ‹è¯•æ‰§è¡Œé¡ºåº
é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨ç¡®å®šæ€§ä½†æ•…æ„ä¸æ˜æ˜¾çš„ç®—æ³•å¯¹æµ‹è¯•æ–¹æ³•è¿›è¡Œæ’åºã€‚è¿™ç¡®ä¿äº†æµ‹è¯•å¥—ä»¶çš„åç»­è¿è¡Œä»¥ç›¸åŒçš„é¡ºåºæ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼Œä»è€Œå…è®¸å¯é‡å¤çš„æ„å»ºã€‚åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ï¼Œæµ‹è¯•æ–¹æ³•æ˜¯ä½¿ç”¨@Testã€@RepeatedTestã€@ParameterizedTestã€@TestFactory æˆ–@TestTemplate ç›´æ¥æ³¨é‡Šæˆ–å…ƒæ³¨é‡Šçš„ä»»ä½•å®ä¾‹æ–¹æ³•ã€‚
å°½ç®¡çœŸæ­£çš„å•å…ƒæµ‹è¯•é€šå¸¸ä¸åº”ä¾èµ–äºå®ƒä»¬çš„æ‰§è¡Œé¡ºåºï¼Œä½†æœ‰æ—¶éœ€è¦å¼ºåˆ¶æ‰§è¡Œç‰¹å®šçš„æµ‹è¯•æ–¹æ³•æ‰§è¡Œé¡ºåºâ€‰-â€‰ä¾‹å¦‚ï¼Œåœ¨ç¼–å†™é›†æˆæµ‹è¯•æˆ–åŠŸèƒ½æµ‹è¯•æ—¶ï¼Œæµ‹è¯•çš„é¡ºåºæ˜¯é‡è¦ï¼Œå°¤å…¶æ˜¯ä¸ @TestInstance(Lifecycle.PER_CLASS) ç»“åˆä½¿ç”¨ã€‚
