---
tags: note
status: todo
priority: 1
time: 2022-06-06 16:02
things:  "[ğŸ§Š](things:///show?id=JtkDsmtmq6Bd8ZbzKBJTW4)"
---
# è¯»å–Excelæ–‡ä»¶

æµ‹è¯•äººå‘˜å¾ˆå–œæ¬¢ç”¨Excelæ¥ç®¡ç†æµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨åšè‡ªåŠ¨åŒ–æ—¶ï¼Œæƒ³è¦é€šè¿‡æµ‹è¯•æ¡†æ¶JUnit5è¿›è¡Œå¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹è§£æã€‚åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€ä¸‹ï¼Œå¸¸ç”¨çš„è§£æexcelæ–¹å¼æœ‰ä¸‰ç§ï¼š


|è§£ææ–¹å¼|è¯´æ˜|
|---|---|
|JXL|å¼€æºçš„Java Excel APIé¡¹ç›®<br/>2011åæœªæ›´æ–°|
|JExcel|ä¸æ˜¯JXL<br/>2019åæœªæ›´æ–°|
|Apache POI|[å®˜ç½‘](https://poi.apache.org/)<br/>æ”¯æŒ xlsã€xlsx<br/>ç¤¾åŒºå¼ºå¤§ï¼Œæ›´æ–°å¿«ï¼Œè‡³ä»Šè¿˜åœ¨æ›´æ–°|


ç»¼ä¸Šæ¯”è¾ƒï¼Œæˆ‘ä¸ªäººæ¨èå¤§å®¶ç”¨POIè¿›è¡Œè§£æï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹å…·ä½“è§£æè¿‡ç¨‹ã€‚

## è§£ææ­¥éª¤
#### pomå¯¼å…¥ç›¸å…³ä¾èµ–

```xml
<!-- https://mvnrepository.com/artifact/org.apache.poi/poi -->
<dependency>
    <groupId>org.apache.poi</groupId>
    <artifactId>poi</artifactId>
    <version>${poi.version}</version>
</dependency>
<!-- https://mvnrepository.com/artifact/org.apache.poi/poi-ooxml -->
<dependency>
    <groupId>org.apache.poi</groupId>
    <artifactId>poi-ooxml</artifactId>
    <version>${poi.version}</version>
</dependency>
```
- å®Œæ•´ä¾èµ–
```xml
<properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <java.version>11</java.version>
    <!-- ä½¿ç”¨ Java 11 è¯­è¨€ç‰¹æ€§ ( -source 11 ) å¹¶ä¸”è¿˜å¸Œæœ›ç¼–è¯‘åçš„ç±»ä¸ JVM 11 ( -target 11 )å…¼å®¹ï¼Œæ‚¨å¯ä»¥æ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªå±æ€§ï¼Œå®ƒä»¬æ˜¯é»˜è®¤å±æ€§æ’ä»¶å‚æ•°çš„åç§°-->
    <maven.compiler.target>11</maven.compiler.target>
    <maven.compiler.source>11</maven.compiler.source>
    <!-- å¯¹åº”junit Jupiterçš„ç‰ˆæœ¬å·;æ”¾åœ¨è¿™é‡Œå°±ä¸éœ€è¦åœ¨æ¯ä¸ªä¾èµ–é‡Œé¢å†™ç‰ˆæœ¬å·ï¼Œå¯¼è‡´å¯¹åº”ç‰ˆæœ¬å·ä¼šå†²çª-->
    <junit.jupiter.version>5.8.2</junit.jupiter.version>

    <maven.compiler.version>3.8.1</maven.compiler.version>
    <maven.surefire.version>3.0.0-M5</maven.surefire.version>
    <!-- plugins -->
    <maven-surefire-plugin.version>3.0.0-M5</maven-surefire-plugin.version>
    <poi.version>5.2.2</poi.version>
</properties>

<!--    ç‰©æ–™æ¸…å• (BOM)-->
<dependencyManagement>
    <dependencies>
        <!--å½“ä½¿ç”¨ Gradle æˆ– Maven å¼•ç”¨å¤šä¸ª JUnit å·¥ä»¶æ—¶ï¼Œæ­¤ç‰©æ–™æ¸…å• POM å¯ç”¨äºç®€åŒ–ä¾èµ–é¡¹ç®¡ç†ã€‚ä¸å†éœ€è¦åœ¨æ·»åŠ ä¾èµ–æ—¶è®¾ç½®ç‰ˆæœ¬-->
        <dependency>
            <groupId>org.junit</groupId>
            <artifactId>junit-bom</artifactId>
            <version>${junit.jupiter.version}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>

    </dependencies>
</dependencyManagement>



<dependencies>
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter</artifactId>
        <!--            å¯¹åº”æ·»åŠ çš„ä¾èµ–çš„ä½œç”¨èŒƒå›´-->
        <scope>test</scope>
    </dependency>

    <dependency>
        <groupId>org.junit.platform</groupId>
        <artifactId>junit-platform-suite</artifactId>
        <scope>test</scope>
    </dependency>

    <dependency>
        <groupId>org.junit.vintage</groupId>
        <artifactId>junit-vintage-engine</artifactId>
        <version>${junit.jupiter.version}</version>
    </dependency>


    <!-- https://mvnrepository.com/artifact/org.apache.poi/poi -->
    <dependency>
        <groupId>org.apache.poi</groupId>
        <artifactId>poi</artifactId>
        <version>${poi.version}</version>
    </dependency>
    <!-- https://mvnrepository.com/artifact/org.apache.poi/poi-ooxml -->
    <dependency>
        <groupId>org.apache.poi</groupId>
        <artifactId>poi-ooxml</artifactId>
        <version>${poi.version}</version>
    </dependency>

</dependencies>


<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>${maven-surefire-plugin.version}</version>

            <dependencies>
                <dependency>
                    <groupId>org.junit.jupiter</groupId>
                    <artifactId>junit-jupiter-engine</artifactId>
                    <version>${junit.jupiter.version}</version>
                </dependency>
                <dependency>
                    <groupId>org.junit.vintage</groupId>
                    <artifactId>junit-vintage-engine</artifactId>
                    <version>${junit.jupiter.version}</version>
                </dependency>
            </dependencies>
        </plugin>
    </plugins>
</build>
```


### poiè§£ææ­¥éª¤
 * 1ã€è·å–æ–‡ä»¶ç»“å°¾ç±»å‹ã€Œ`xls`ã€`xlsx`ã€
 * 2ã€`excel` æ–‡ä»¶åŠ è½½ä¸ºæ–‡ä»¶è¾“å…¥æµ
 * 3ã€è·å–å·¥ä½œè–„å¯¹è±¡`Workbook`
   * å¦‚æœæ˜¯`xls`ç»“å°¾ç”¨`HSSF` 
   * å¦‚æœæ˜¯`xlsx`ç»“å°¾ç”¨`XSSF`
 * 4ã€è¯»å–ç¬¬ä¸€ä¸ª`sheet`
 * 5ã€æ¯ä¸€è¡Œå…·ä½“æ•°æ®ä¸º`list`
 * 6ã€ä»ç¬¬ä¸€è¡Œå¼€å§‹è§£æ
 * 7ã€æœ€åå…³é—­æµ


### demoåˆ†è§£
#### è·å–å·¥ä½œè–„å¯¹è±¡Workbook
-  ä½¿ç”¨è¾“å…¥æµçš„å½¢å¼æ‰“å¼€æ–‡ä»¶è·å–å·¥ä½œè–„å¯¹è±¡
```java
//æ–¹å¼ä¸€ï¼šæµçš„å½¢å¼æ‰“å¼€æ–‡ä»¶
//ä½¿ç”¨ InputStream æ¯”ä½¿ç”¨ File éœ€è¦æ›´å¤šå†…å­˜ï¼Œå› æ­¤ File å¯ç”¨
FileInputStream file = new FileInputStream(new File("src/test/resources/orderLines.xlsx"));
Workbook workbook = new XSSFWorkbook(file);
```
- ç›´æ¥ä½¿ç”¨fileæ‰“å¼€æ–‡ä»¶è·å–å·¥ä½œè–„å¯¹è±¡
```java
//æ–¹å¼äºŒï¼šç›´æ¥ä½¿ç”¨file
Workbook workbook = new XSSFWorkbook(new File("src/test/resources/orderLines.xlsx"));
```

#### è·å–sheet
- è·å–ç¬¬ä¸€ä¸ªsheetæ ‡ç­¾é¡µ
```java
//è¯»å–ç¬¬ä¸€ä¸ªsheet
Sheet sheet = workbook.getSheetAt(0);
```

- æƒ³è¦è·å–å“ªä¸ªå°±è¯»å–å“ªä¸ªsheet
```java
//è¯»å–ç¬¬nä¸ªsheet
Sheet sheet = workbook.getSheetAt(n-1);
```

-  è·å–å½“å‰å·¥ä½œè–„æœ‰å‡ ä¸ªsheetæ ‡ç­¾é¡µ
```java
int numberOfSheets = workbook.getNumberOfSheets();
```
#### è·å–è¡Œæ•°
-  è·å–sheetä¸­æœ‰å¤šå°‘è¡Œ
 
```java
int rows = sheet.getPhysicalNumberOfRows();
```
-  ä¸€ä¸ªsheeté‡Œé¢æœ‰å¤šä¸ªrow
```java
Map<Integer, List<Object>> data = new HashMap<>();
int i = 0;
for (Row row : sheet) {
   //{0=[]}
   data.put(i, new ArrayList<Object>());
   i++;
}
System.out.println("dataï¼š" + data);//dataï¼š{0=[], 1=[], 2=[]}
```

#### è·å–æ¯ä¸€ä¸ªå•å…ƒæ ¼æ•°æ®
-  ä¸€è¡Œã€Œrowã€æœ‰å¤šä¸ªå•å…ƒæ ¼ã€ŒCellã€
```java
//map<è¡Œå·,listæ˜¯è¡Œå†…å®¹>
Map<Integer, List<Object>> data = new HashMap<>();
int i = 0;
for (Row row : sheet) {
   //{0=[]}
   data.put(i, new ArrayList<Object>());

   for(Cell cell:row){
       //[]
       //æ¯ä¸€ä¸ªå•å…ƒæ ¼å°±æ˜¯ArrayListé‡Œé¢ä¸€ä¸ªå…ƒç´ 
       List<Object> objectList = data.get(i);

       objectList.add(cell);

   }
   i++;
}
System.out.println("dataï¼š" + data);
//dataï¼š{0=[item, quantity, unitPrice, orderDate], 1=[No. 9 Sprockets, 12.0, 1.23, 17-4æœˆ-2019], 2=[Widget (10mm), 4.0, 3.45, 16-1æœˆ-2022]}

```

#### æ•°æ®è§£æç±»å‹
- excelå¯ä»¥è®¾ç½®åˆ—çš„æ•°æ®ç±»å‹
```java
switch (cell.getCellType()) {
  //å•å…ƒæ ¼ç±»å‹æšä¸¾å€¼ä¸ºSTRINGæ—¶ï¼Œå°†ä½¿ç”¨Cellæ¥å£çš„getRichStringCellValue()æ–¹æ³•è¯»å–å†…å®¹ï¼š
  //æ–‡æœ¬æ ¼å¼çš„å†…å®¹è¯»å–
  case STRING:
      cell.getRichStringCellValue().getString();
      break;
  // æ•°å­—ã€æ—¥æœŸ
  case NUMERIC:
      if (DateUtil.isCellDateFormatted(cell)) {
          //æ—¥æœŸå‹ä»¥å¹´-æœˆ-æ—¥æ ¼å¼å­˜å‚¨
          SimpleDateFormat fmt = new SimpleDateFormat("yyyy-MM-dd");
          fmt.format(cell.getDateCellValue());
      } else {
          cell.getNumericCellValue();
      }
      break;
  case BOOLEAN:
      cell.getBooleanCellValue();
      break;
  case FORMULA:
      cell.getCellFormula();
      break;
  default: data.get(Integer.valueOf(i)).add(" ");
}
```


### å®Œæ•´demo
```java
import org.apache.poi.openxml4j.exceptions.InvalidFormatException;
import org.apache.poi.ss.usermodel.*;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.junit.jupiter.api.Test;

import java.io.File;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class ExcelTest {
    @Test
    void test() throws IOException, InvalidFormatException {

        //æ–¹å¼ä¸€ï¼šæµçš„å½¢å¼æ‰“å¼€æ–‡ä»¶
        //ä½¿ç”¨ InputStream æ¯”ä½¿ç”¨ File éœ€è¦æ›´å¤šå†…å­˜ï¼Œå› æ­¤ File å¯ç”¨
//        FileInputStream file = new FileInputStream(new File("src/test/resources/orderLines.xlsx"));
//        Workbook workbook = new XSSFWorkbook(file);
        //æ–¹å¼äºŒï¼šç›´æ¥ä½¿ç”¨file
        Workbook workbook = new XSSFWorkbook(new File("src/test/resources/orderLines.xlsx"));
        //è¯»å–ç¬¬ä¸€ä¸ªsheet
        Sheet sheet = workbook.getSheetAt(0);
        //map<è¡Œå·,listæ˜¯è¡Œå†…å®¹>
        Map<Integer, List<Object>> data = new HashMap<>();
        int i = 0;
        for (Row row : sheet) {
            //{0=[]}
            data.put(i, new ArrayList<Object>());
            System.out.println("dataï¼š"+ data);
            for (Cell cell : row) {
                List<Object> objects = data.get(Integer.valueOf(i));
                switch (cell.getCellType()) {
                    //å•å…ƒæ ¼ç±»å‹æšä¸¾å€¼ä¸ºSTRINGæ—¶ï¼Œå°†ä½¿ç”¨Cellæ¥å£çš„getRichStringCellValue()æ–¹æ³•è¯»å–å†…å®¹ï¼š
                    //æ–‡æœ¬æ ¼å¼çš„å†…å®¹è¯»å–
                    case STRING:
                        objects.add(cell.getRichStringCellValue().getString());
                        break;
                    // æ•°å­—ã€æ—¥æœŸ
                    case NUMERIC:
                        if (DateUtil.isCellDateFormatted(cell)) {
                            //æ—¥æœŸå‹ä»¥å¹´-æœˆ-æ—¥æ ¼å¼å­˜å‚¨
                            SimpleDateFormat fmt = new SimpleDateFormat("yyyy-MM-dd");
                            objects.add(fmt.format(cell.getDateCellValue()) + "");
                        } else {
                            objects.add(cell.getNumericCellValue() + "");
                        }
                        break;
                    case BOOLEAN:
                        objects.add(cell.getBooleanCellValue() + "");
                        break;
                    case FORMULA:
                        objects.add(cell.getCellFormula() + "");
                        break;
                    default: data.get(Integer.valueOf(i)).add(" ");
                }
            }
            i++;
        }
        System.out.println(data);
        //å…³é—­æµ
        workbook.close();
    }
}
```


##  ç»“è®º

æœ¬æ–‡è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨Apache POI API  ä» Java ç¨‹åºä¸­è¯»å–Excel æ–‡ä»¶

æœ¬æ–‡çš„å®Œæ•´æºä»£ç å¯ä»¥åœ¨[GitHub é¡¹ç›®](https://github.com/testeru-top/java_code/blob/master/juit5_tutorials/junit5_excel/src/test/java/top/tester/excel/ExcelTest.java)ä¸­æ‰¾åˆ°ã€‚